<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kasa Y√∂netim Sistemi</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;700&family=Bricolage+Grotesque:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getDatabase, ref, onValue, push, remove, set } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC5YLwaYF59p6QaQwZktgOt0fw3Y4gkfEo",
    authDomain: "kasa-programi-7fa8b.firebaseapp.com",
    databaseURL: "https://kasa-programi-7fa8b-default-rtdb.firebaseio.com",
    projectId: "kasa-programi-7fa8b",
    storageBucket: "kasa-programi-7fa8b.firebasestorage.app",
    messagingSenderId: "756803325479",
    appId: "1:756803325479:web:c5ba134d125c3930f50802",
    measurementId: "G-DFL17WR3M3"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const islemlerRef = ref(db, 'islemler');

  onValue(islemlerRef, (snapshot) => {
    const data = snapshot.val();
    window.islemler = data
      ? Object.entries(data).map(([fbKey, v]) => ({...v, fbKey})).sort((a,b) => b.id - a.id)
      : [];
    if (window.appBasladi) {
      window.renderHepsi();
      document.getElementById('syncText').textContent = 'CANLI';
      document.getElementById('syncDot').style.background = '#1a7a4a';
    }
  }, () => {
    document.getElementById('syncText').textContent = 'BAƒûLANTI YOK';
    document.getElementById('syncDot').style.background = '#c84b2f';
  });

  window.fbIslemEkle = async (islem) => await push(islemlerRef, islem);
  window.fbIslemSil  = async (fbKey) => await remove(ref(db, 'islemler/' + fbKey));

  const ayarlarRef = ref(db, 'ayarlar');
  onValue(ayarlarRef, (snapshot) => {
    const data = snapshot.val();
    if (data) {
      if (data.sifreler) SIFRELER = {...SIFRELER, ...data.sifreler};
      if (data.isimler) {
        ISIMLER = {...ISIMLER, ...data.isimler};
        ['k1','k2'].forEach(k => {
          const isim = ISIMLER[k];
          const el1 = document.querySelector(`.kk-${k} .kasa-kart-kisi`);
          if (el1) el1.textContent = isim;
          const el2 = document.querySelector(`.login-kasa-btn.${k} .kasa-kisi`);
          if (el2) el2.textContent = isim;
        });
      }
      if (data.kilitDakika) {
        KILIT_SURE = data.kilitDakika * 60 * 1000;
        const el = document.getElementById('aktifKilitSure');
        if (el) el.textContent = data.kilitDakika + ' dk';
        const inp = document.getElementById('aKilitSure');
        if (inp) inp.value = data.kilitDakika;
      }
    }
    if (window.appBasladi) ayarlariDoldur();
  });
  window.fbAyarKaydet = async (data) => await set(ayarlarRef, data);
</script>

<style>
:root {
  --bg: #f5f0e8;
  --bg2: #ede8dc;
  --surface: #ffffff;
  --border: #d4cfc4;
  --border2: #c4bfb4;
  --text: #1a1814;
  --muted: #8a8478;
  --k1: #c84b2f;
  --k1-light: rgba(200,75,47,0.1);
  --k2: #2563a8;
  --k2-light: rgba(37,99,168,0.1);
  --giren: #1a7a4a;
  --giren-light: rgba(26,122,74,0.08);
  --cikan: #c84b2f;
  --cikan-light: rgba(200,75,47,0.08);
  --gold: #b8860b;
  --shadow: 0 2px 12px rgba(0,0,0,0.08);
  --shadow-lg: 0 8px 32px rgba(0,0,0,0.12);
}
* { margin:0; padding:0; box-sizing:border-box; }
body {
  background: var(--bg);
  color: var(--text);
  font-family: 'Bricolage Grotesque', sans-serif;
  min-height: 100vh;
  background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23c4bfb4' fill-opacity='0.15'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
}

#loginScreen { position:fixed; inset:0; background:var(--bg); display:flex; align-items:center; justify-content:center; z-index:9999; }
.login-box { background:var(--surface); border:2px solid var(--border); border-radius:20px; padding:48px 40px; width:380px; text-align:center; box-shadow:var(--shadow-lg); }
.login-logo { font-size:12px; font-family:'IBM Plex Mono',monospace; letter-spacing:4px; color:var(--muted); text-transform:uppercase; margin-bottom:8px; }
.login-title { font-size:28px; font-weight:800; margin-bottom:36px; }
.login-kasalar { display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:24px; }
.login-kasa-btn { padding:16px 12px; border:2px solid var(--border); border-radius:12px; background:var(--bg2); cursor:pointer; font-family:'Bricolage Grotesque',sans-serif; transition:all 0.25s; opacity:0.5; }
.login-kasa-btn .kasa-isim { font-size:10px; font-family:'IBM Plex Mono',monospace; letter-spacing:2px; text-transform:uppercase; color:var(--muted); margin-bottom:4px; transition:color 0.25s; }
.login-kasa-btn .kasa-kisi { font-size:18px; font-weight:700; color:var(--muted); transition:color 0.25s; }
.login-kasa-btn.k1:hover { opacity:1; background:var(--surface); border-color:var(--k1); border-left:4px solid var(--k1); box-shadow:0 0 0 3px var(--k1-light); transform:translateY(-2px); }
.login-kasa-btn.k1:hover .kasa-kisi { color:var(--k1); }
.login-kasa-btn.k2:hover { opacity:1; background:var(--surface); border-color:var(--k2); border-left:4px solid var(--k2); box-shadow:0 0 0 3px var(--k2-light); transform:translateY(-2px); }
.login-kasa-btn.k2:hover .kasa-kisi { color:var(--k2); }
.login-kasa-btn.admin-btn:hover { opacity:1; background:var(--surface); border-color:var(--text); border-left:4px solid var(--text); box-shadow:0 0 0 3px rgba(26,24,20,0.1); transform:translateY(-2px); }
.login-kasa-btn.admin-btn:hover .kasa-kisi { color:var(--text); }
.login-kasa-btn.selected { opacity:1; background:var(--surface); }
.login-kasa-btn.selected.k1 { border-color:var(--k1); border-left:4px solid var(--k1); box-shadow:0 0 0 3px var(--k1-light); }
.login-kasa-btn.selected.k1 .kasa-kisi { color:var(--k1); }
.login-kasa-btn.selected.k2 { border-color:var(--k2); border-left:4px solid var(--k2); box-shadow:0 0 0 3px var(--k2-light); }
.login-kasa-btn.selected.k2 .kasa-kisi { color:var(--k2); }
.login-kasa-btn.selected.admin-btn { border-color:var(--text); border-left:4px solid var(--text); box-shadow:0 0 0 3px rgba(26,24,20,0.1); }
.login-kasa-btn.selected.admin-btn .kasa-kisi { color:var(--text); }
.login-sep { display:flex; align-items:center; gap:12px; margin-bottom:20px; }
.login-sep hr { flex:1; border:none; border-top:1px solid var(--border); }
.login-sep span { font-size:11px; color:var(--muted); font-family:'IBM Plex Mono',monospace; }
.login-input { width:100%; padding:14px 16px; border:2px solid var(--border); border-radius:12px; background:var(--bg); font-family:'IBM Plex Mono',monospace; font-size:16px; letter-spacing:4px; text-align:center; outline:none; transition:border-color 0.2s; margin-bottom:16px; }
.login-input:focus { border-color:var(--text); }
.login-btn { width:100%; padding:14px; border:none; border-radius:12px; background:var(--text); color:var(--bg); font-family:'Bricolage Grotesque',sans-serif; font-size:15px; font-weight:700; cursor:pointer; transition:all 0.2s; }
.login-btn:hover { background:#2a2520; transform:translateY(-1px); }
.login-error { color:var(--k1); font-size:12px; margin-top:12px; font-family:'IBM Plex Mono',monospace; display:none; }

#app { display:none; }
header { background:var(--surface); border-bottom:2px solid var(--border); padding:0 24px; display:flex; align-items:center; justify-content:space-between; height:58px; position:sticky; top:0; z-index:100; box-shadow:0 2px 8px rgba(0,0,0,0.06); }
.header-left { display:flex; align-items:center; gap:16px; }
.brand { font-family:'IBM Plex Mono',monospace; font-size:13px; font-weight:700; letter-spacing:3px; text-transform:uppercase; }
.header-kasa-badge { display:flex; align-items:center; gap:8px; padding:5px 12px; border-radius:20px; font-size:12px; font-weight:600; }
.header-kasa-badge.k1 { background:var(--k1-light); color:var(--k1); border:1px solid var(--k1); }
.header-kasa-badge.k2 { background:var(--k2-light); color:var(--k2); border:1px solid var(--k2); }
.header-kasa-badge .dot { width:7px; height:7px; border-radius:50%; background:currentColor; }
.header-right { display:flex; align-items:center; gap:10px; }
.saat-blok { display:flex; flex-direction:column; align-items:flex-end; padding:4px 14px; background:var(--text); border-radius:10px; line-height:1.2; }
.canli-saat { font-family:'IBM Plex Mono',monospace; font-size:22px; font-weight:700; color:var(--bg); letter-spacing:2px; }
.canli-tarih { font-family:'IBM Plex Mono',monospace; font-size:11px; font-weight:500; color:rgba(245,240,232,0.6); letter-spacing:1px; }
.sync-pill { display:flex; align-items:center; gap:6px; padding:5px 12px; background:var(--bg2); border:1px solid var(--border); border-radius:20px; font-family:'IBM Plex Mono',monospace; font-size:11px; color:var(--muted); }
.sync-dot { width:7px; height:7px; border-radius:50%; background:var(--giren); animation:pulse 2s infinite; transition:background 0.3s; }
@keyframes pulse { 0%,100%{opacity:1}50%{opacity:0.4} }
.icon-btn { padding:7px 14px; border:1px solid var(--border); border-radius:8px; background:transparent; color:var(--muted); font-family:'Bricolage Grotesque',sans-serif; font-size:13px; font-weight:500; cursor:pointer; transition:all 0.2s; }
.icon-btn:hover { border-color:var(--text); color:var(--text); }

nav { display:flex; gap:2px; background:var(--bg2); border-bottom:2px solid var(--border); padding:0 24px; overflow-x:auto; }
.nav-btn { padding:12px 18px; border:none; background:transparent; font-family:'Bricolage Grotesque',sans-serif; font-size:13px; font-weight:600; color:var(--muted); cursor:pointer; border-bottom:3px solid transparent; margin-bottom:-2px; transition:all 0.2s; white-space:nowrap; }
.nav-btn:hover { color:var(--text); }
.nav-btn.active { color:var(--text); border-bottom-color:var(--text); }

main { max-width:1400px; margin:0 auto; padding:20px 24px; }
.tab-content { display:none; }
.tab-content.active { display:block; }

.kasa-secim { display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-bottom:16px; }
.kasa-kart { background:var(--bg2); border:2px solid var(--border); border-radius:14px; padding:18px 22px; cursor:pointer; transition:all 0.3s; opacity:0.6; }
.kasa-kart.active-k1 { border-color:var(--k1); box-shadow:0 0 0 3px var(--k1-light); background:var(--surface); opacity:1; }
.kasa-kart.active-k2 { border-color:var(--k2); box-shadow:0 0 0 3px var(--k2-light); background:var(--surface); opacity:1; }
.kasa-kart:hover { transform:translateY(-1px); box-shadow:var(--shadow); opacity:0.85; }
.kasa-kart.active-k1:hover, .kasa-kart.active-k2:hover { opacity:1; }
.kasa-baslik-kart { cursor:default !important; }
.kasa-baslik-kart:hover { transform:none !important; }
.kk-k1.kasa-baslik-kart { border-color:var(--border2); border-left:5px solid var(--muted); }
.kk-k2.kasa-baslik-kart { border-color:var(--border2); border-left:5px solid var(--muted); }
.kk-k1.kasa-baslik-kart.active-k1 { border-color:var(--k1); border-left:5px solid var(--k1); box-shadow:0 0 0 3px var(--k1-light); background:var(--surface); opacity:1; }
.kk-k2.kasa-baslik-kart.active-k2 { border-color:var(--k2); border-left:5px solid var(--k2); box-shadow:0 0 0 3px var(--k2-light); background:var(--surface); opacity:1; }
.kasa-kart-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:10px; }
.kasa-kart-isim { font-family:'IBM Plex Mono',monospace; font-size:10px; letter-spacing:3px; text-transform:uppercase; color:var(--muted); }
.kasa-kart-kisi { font-size:20px; font-weight:800; }
.kk-k1 .kasa-kart-kisi { color:var(--k1); }
.kk-k2 .kasa-kart-kisi { color:var(--k2); }
.kasa-kart-tutar { font-family:'IBM Plex Mono',monospace; font-size:26px; font-weight:700; }
.kasa-kart-alt { display:flex; gap:20px; margin-top:8px; }
.kasa-mini { font-family:'IBM Plex Mono',monospace; font-size:12px; }
.km-giren { color:var(--giren); }
.km-cikan { color:var(--cikan); }

.form-bar { background:var(--surface); border:2px solid var(--border); border-radius:14px; padding:16px 20px; display:flex; align-items:flex-end; gap:14px; margin-bottom:16px; }
.form-bar-bolum { display:flex; flex-direction:column; gap:6px; }
.form-bar-bolum.tutar { width:160px; }
.form-bar-bolum.aciklama { flex:1; }
.field-label { font-size:10px; font-weight:700; letter-spacing:2px; text-transform:uppercase; color:var(--muted); }
.field-input { background:var(--bg); border:2px solid var(--border); border-radius:10px; padding:10px 14px; color:var(--text); font-family:'IBM Plex Mono',monospace; font-size:15px; outline:none; transition:border-color 0.2s; width:100%; }
.field-input:focus { border-color:var(--text); }
.field-input.big { font-size:20px; font-weight:700; }
.form-bar-btns { display:flex; gap:10px; flex-shrink:0; }
.ekle-btn { padding:10px 22px; border:none; border-radius:10px; font-family:'Bricolage Grotesque',sans-serif; font-size:14px; font-weight:800; cursor:pointer; transition:all 0.2s; white-space:nowrap; }
.ekle-btn.giren { background:var(--giren); color:white; }
.ekle-btn.cikan { background:var(--cikan); color:white; }
.ekle-btn:hover { transform:translateY(-1px); filter:brightness(1.08); box-shadow:var(--shadow); }
.ekle-btn:disabled { opacity:0.5; cursor:not-allowed; transform:none; }

.vezne-kasa-baslik { font-family:'IBM Plex Mono',monospace; font-size:13px; font-weight:700; letter-spacing:1px; color:var(--muted); margin-bottom:8px; padding:0 2px; }
.vezne-tablo-wrap { transition:border-color 0.3s,box-shadow 0.3s; display:grid; grid-template-columns:1fr 3px 1fr; background:var(--surface); border:2px solid var(--border); border-radius:14px; overflow:hidden; min-height:500px; }
.vezne-ayrac { background:var(--border); }
.vezne-col { display:flex; flex-direction:column; }
.vezne-col-baslik { display:flex; align-items:center; justify-content:space-between; padding:14px 18px; font-family:'IBM Plex Mono',monospace; font-size:12px; font-weight:700; letter-spacing:1px; border-bottom:2px solid var(--border); }
.vezne-giren .vezne-col-baslik { background:var(--giren-light); color:var(--giren); }
.vezne-cikan .vezne-col-baslik { background:var(--cikan-light); color:var(--cikan); }
.vezne-toplam { font-size:16px; font-weight:700; }
.vezne-tablo { width:100%; border-collapse:collapse; }
.vezne-tablo thead tr { background:var(--bg2); }
.vezne-tablo th { padding:10px 14px; text-align:left; font-family:'IBM Plex Mono',monospace; font-size:10px; letter-spacing:2px; text-transform:uppercase; color:var(--muted); font-weight:500; border-bottom:1px solid var(--border); }
.vezne-tablo td { padding:10px 14px; border-bottom:1px solid var(--border); font-size:13px; vertical-align:middle; }
.vezne-tablo tr:last-child td { border-bottom:none; }
.vezne-tablo tr:hover td { background:var(--bg); }
.vezne-tablo .td-tutar { font-family:'IBM Plex Mono',monospace; font-size:14px; font-weight:700; white-space:nowrap; }
.vezne-giren .td-tutar { color:var(--giren); }
.vezne-cikan .td-tutar { color:var(--cikan); }
.vezne-tablo .td-saat { font-family:'IBM Plex Mono',monospace; font-size:11px; color:var(--muted); white-space:nowrap; }
.vezne-tablo .td-aciklama { color:var(--text); font-weight:500; }
.sil-btn { padding:3px 8px; border:1px solid var(--border); border-radius:6px; background:transparent; color:var(--muted); font-size:11px; cursor:pointer; transition:all 0.2s; opacity:0; }
tr:hover .sil-btn { opacity:1; }
.sil-btn:hover { border-color:var(--cikan); color:var(--cikan); background:var(--cikan-light); }
.bos-msg { text-align:center; color:var(--muted); padding:40px 20px; font-family:'IBM Plex Mono',monospace; font-size:12px; }

.toplam-satir td { border-top:2px solid var(--border) !important; border-bottom:none !important; padding:12px 14px !important; }
.toplam-satir { background:var(--bg2) !important; }
.toplam-satir:hover td { background:var(--bg2) !important; }
.toplam-tutar { font-family:'IBM Plex Mono',monospace !important; font-size:15px !important; font-weight:800 !important; }
.toplam-giren .toplam-tutar { color:var(--giren) !important; }
.toplam-cikan .toplam-tutar { color:var(--cikan) !important; }

.hizli-fm-wrap { background:var(--surface); border:2px solid var(--gold); border-radius:14px; padding:16px 20px; }
.hizli-fm-label { font-family:'IBM Plex Mono',monospace; font-size:11px; font-weight:700; letter-spacing:2px; color:var(--gold); margin-bottom:12px; }
.hizli-fm-row { display:flex; align-items:flex-start; gap:16px; }
.hizli-fm-bolum { width:260px; flex-shrink:0; }
.hizli-fm-sonuc { flex:1; border-radius:10px; padding:12px 16px; font-family:'IBM Plex Mono',monospace; font-size:13px; display:none; align-self:center; }
.hizli-fm-sonuc.esit { background:rgba(26,122,74,0.1); border:2px solid var(--giren); display:block; }
.hizli-fm-sonuc.fark { background:rgba(200,75,47,0.08); border:2px solid var(--cikan); display:block; }
.hizli-fm-satir { display:flex; justify-content:space-between; padding:3px 0; }
.hizli-fm-satir.toplam { font-weight:700; font-size:15px; margin-top:6px; padding-top:8px; border-top:1px solid rgba(0,0,0,0.08); }
.fm-not-bolum { margin-top:14px; padding-top:14px; border-top:1px solid var(--border); }
.fm-not-input { width:100%; background:var(--bg); border:2px solid var(--border); border-radius:10px; padding:12px 14px; color:var(--text); font-family:'Bricolage Grotesque',sans-serif; font-size:14px; resize:vertical; min-height:80px; outline:none; transition:border-color 0.2s; line-height:1.5; }
.fm-not-input:focus { border-color:var(--gold); }

.tarih-filtre { display:flex; align-items:center; gap:10px; margin-bottom:16px; flex-wrap:wrap; }
.tarih-filtre input[type="date"] { padding:8px 12px; border:2px solid var(--border); border-radius:10px; background:var(--surface); font-family:'IBM Plex Mono',monospace; font-size:13px; color:var(--text); outline:none; }
.filtre-btn { padding:8px 14px; border:2px solid var(--border); border-radius:10px; background:transparent; font-family:'Bricolage Grotesque',sans-serif; font-size:13px; font-weight:600; color:var(--muted); cursor:pointer; transition:all 0.2s; }
.filtre-btn:hover,.filtre-btn.active { border-color:var(--text); color:var(--text); background:var(--surface); }

.rapor-tablo { background:var(--surface); border:2px solid var(--border); border-radius:14px; overflow:hidden; }
.rapor-tablo table { width:100%; border-collapse:collapse; font-size:13px; }
.rapor-tablo thead tr { background:var(--bg2); border-bottom:2px solid var(--border); }
.rapor-tablo th { padding:11px 16px; text-align:left; font-family:'IBM Plex Mono',monospace; font-size:10px; letter-spacing:2px; text-transform:uppercase; color:var(--muted); font-weight:500; }
.rapor-tablo td { padding:10px 16px; border-bottom:1px solid var(--border); font-family:'IBM Plex Mono',monospace; font-size:12px; }
.rapor-tablo tr:last-child td { border-bottom:none; }
.rapor-tablo tr:hover td { background:var(--bg2); }

.faturamatik-wrap { display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-bottom:20px; }
.faturamatik-kasa-blok { background:var(--surface); border:2px solid var(--border); border-radius:14px; padding:22px; }
.fm-baslik { display:flex; align-items:center; gap:12px; margin-bottom:18px; }
.fm-kasa-isim { font-family:'IBM Plex Mono',monospace; font-size:12px; font-weight:700; letter-spacing:1px; }
.fm-alt { font-size:11px; color:var(--muted); margin-top:2px; font-family:'IBM Plex Mono',monospace; }
.fm-input-row { position:relative; margin-bottom:14px; }
.fm-input { width:100%; padding:14px 42px 14px 16px; border:2px solid var(--border); border-radius:10px; background:var(--bg); font-family:'IBM Plex Mono',monospace; font-size:24px; font-weight:700; color:var(--text); outline:none; transition:border-color 0.2s; }
.fm-input:focus { border-color:var(--gold); }
.fm-tl { position:absolute; right:14px; top:50%; transform:translateY(-50%); font-family:'IBM Plex Mono',monospace; font-size:18px; color:var(--muted); }
.fm-sonuc { border-radius:10px; padding:14px 16px; font-family:'IBM Plex Mono',monospace; font-size:13px; display:none; }
.fm-sonuc.esit { background:rgba(26,122,74,0.1); border:2px solid var(--giren); display:block; }
.fm-sonuc.fark { background:rgba(200,75,47,0.08); border:2px solid var(--cikan); display:block; }
.fm-sonuc-satir { display:flex; justify-content:space-between; padding:4px 0; }
.fm-sonuc-satir:last-child { font-weight:700; font-size:15px; margin-top:6px; padding-top:10px; border-top:1px solid rgba(0,0,0,0.08); }

.gunsonu-wrap { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
.gunsonu-kasa-ozet { background:var(--surface); border:2px solid var(--border); border-radius:14px; padding:24px; }
.gunsonu-kasa-ozet h3 { font-size:15px; font-weight:800; margin-bottom:18px; display:flex; align-items:center; gap:10px; }
.gs-satir { display:flex; justify-content:space-between; padding:9px 0; border-bottom:1px solid var(--border); font-size:13px; }
.gs-satir:last-child { border-bottom:none; font-weight:800; font-size:15px; }
.gs-satir .gs-label { color:var(--muted); }
.gs-satir .gs-val { font-family:'IBM Plex Mono',monospace; font-weight:700; }

.kullanici-grid { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
.kullanici-kart { background:var(--surface); border:2px solid var(--border); border-radius:14px; padding:22px; }
.kullanici-kart h3 { display:flex; align-items:center; gap:10px; font-size:15px; font-weight:800; margin-bottom:18px; }
.kullanici-avatar { width:38px; height:38px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:15px; font-weight:800; color:white; }
.av-k1 { background:var(--k1); }
.av-k2 { background:var(--k2); }
.kullanici-bilgi-row { display:flex; justify-content:space-between; align-items:center; padding:9px 0; border-bottom:1px solid var(--border); font-size:13px; }
.kullanici-bilgi-row:last-child { border-bottom:none; }
.kb-label { color:var(--muted); font-family:'IBM Plex Mono',monospace; font-size:11px; }
.kb-val { font-weight:600; font-family:'IBM Plex Mono',monospace; font-size:13px; }
.ulke-history { background:var(--surface); border:2px solid var(--border); border-radius:14px; padding:22px; grid-column:1/-1; }
.ulke-history h3 { font-size:14px; font-weight:700; margin-bottom:14px; }
.activity-row { display:flex; align-items:center; gap:12px; padding:8px 12px; background:var(--bg); border-radius:8px; margin-bottom:6px; font-size:13px; }

.kilit-sure-btn { padding:6px 12px; border:2px solid var(--border); border-radius:8px; background:transparent; font-family:'IBM Plex Mono',monospace; font-size:12px; font-weight:600; color:var(--muted); cursor:pointer; transition:all 0.2s; }
.kilit-sure-btn:hover { border-color:var(--gold); color:var(--gold); background:rgba(184,134,11,0.08); }
.kilit-sure-btn.aktif { border-color:var(--gold); color:var(--gold); background:rgba(184,134,11,0.1); font-weight:700; }

.ayarlar-wrap { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
.ayarlar-kart { background:var(--surface); border:2px solid var(--border); border-radius:14px; padding:24px; }
.ayarlar-baslik { font-size:15px; font-weight:800; margin-bottom:20px; }
.ayarlar-form { display:grid; grid-template-columns:1fr 1fr; gap:14px; margin-bottom:16px; }
.ayarlar-field { display:flex; flex-direction:column; gap:6px; }
.ayarlar-kaydet-btn { padding:11px 24px; border:none; border-radius:10px; background:var(--giren); color:white; font-family:'Bricolage Grotesque',sans-serif; font-size:14px; font-weight:700; cursor:pointer; transition:all 0.2s; }
.ayarlar-kaydet-btn:hover { filter:brightness(1.08); transform:translateY(-1px); }
.k1-btn { background:var(--k1); }
.k2-btn { background:var(--k2); }
.ayarlar-bilgi { margin-top:10px; font-family:'IBM Plex Mono',monospace; font-size:12px; display:none; padding:8px 12px; border-radius:8px; }
.ayarlar-bilgi.ok { background:var(--giren-light); color:var(--giren); display:block; }
.ayarlar-bilgi.err { background:var(--cikan-light); color:var(--cikan); display:block; }

.modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.5); display:flex; align-items:center; justify-content:center; z-index:9998; backdrop-filter:blur(4px); }
.modal { background:var(--surface); border:2px solid var(--border); border-radius:16px; padding:32px; width:340px; box-shadow:var(--shadow-lg); animation:modalIn 0.2s ease; }
@keyframes modalIn { from{opacity:0;transform:scale(0.95)} to{opacity:1;transform:none} }
.modal h3 { font-size:17px; font-weight:800; margin-bottom:8px; }
.modal p { font-size:13px; color:var(--muted); margin-bottom:20px; }
.modal-btns { display:flex; gap:10px; margin-top:20px; }
.modal-btns button { flex:1; padding:11px; border-radius:10px; font-family:'Bricolage Grotesque',sans-serif; font-size:14px; font-weight:700; cursor:pointer; transition:all 0.2s; border:2px solid var(--border); }
.modal-iptal { background:transparent; color:var(--muted); }
.modal-iptal:hover { border-color:var(--text); color:var(--text); }
.modal-onayla { background:var(--cikan); color:white; border-color:var(--cikan); }
.modal-onayla:hover { filter:brightness(1.1); }

.toast { position:fixed; bottom:20px; right:20px; padding:12px 20px; border-radius:12px; font-size:13px; font-weight:600; z-index:9999; animation:toastIn 0.3s ease; box-shadow:var(--shadow-lg); font-family:'IBM Plex Mono',monospace; }
.toast.ok { background:var(--giren); color:white; }
.toast.err { background:var(--cikan); color:white; }
.toast.info { background:var(--text); color:var(--bg); }
@keyframes toastIn { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:none} }

.islem-kullanici { display:inline-block; margin-left:6px; padding:2px 7px; border-radius:20px; font-size:10px; font-weight:700; font-family:'IBM Plex Mono',monospace; background:var(--bg2); color:var(--muted); border:1px solid var(--border); vertical-align:middle; }
.badge { display:inline-flex; align-items:center; padding:3px 8px; border-radius:20px; font-size:10px; font-weight:700; font-family:'IBM Plex Mono',monospace; letter-spacing:1px; }
.badge-k1 { background:var(--k1-light); color:var(--k1); }
.badge-k2 { background:var(--k2-light); color:var(--k2); }
.badge-giren { background:var(--giren-light); color:var(--giren); }
.badge-cikan { background:var(--cikan-light); color:var(--cikan); }
::-webkit-scrollbar { width:5px; }
::-webkit-scrollbar-thumb { background:var(--border); border-radius:3px; }
</style>
</head>
<body>

<div id="loginScreen">
  <div class="login-box">
    <div class="login-logo">FATURA √ñDEME</div>
    <div class="login-title">Kasa Giri≈üi</div>
    <div class="login-kasalar">
      <button class="login-kasa-btn k1" onclick="seciKasa('k1',this)">
        <div class="kasa-isim">Kasa 1</div>
        <div class="kasa-kisi">Kadir</div>
      </button>
      <button class="login-kasa-btn k2" onclick="seciKasa('k2',this)">
        <div class="kasa-isim">Kasa 2</div>
        <div class="kasa-kisi">G√∂rkem</div>
      </button>
      <button class="login-kasa-btn admin-btn" onclick="seciKasa('admin',this)" style="grid-column:1/-1">
        <div class="kasa-isim">Y√∂netici</div>
        <div class="kasa-kisi" style="font-size:15px">‚öô Admin</div>
      </button>
    </div>
    <div class="login-sep"><hr><span>≈ûƒ∞FRE</span><hr></div>
    <input type="password" class="login-input" id="loginSifre" placeholder="" maxlength="20" onkeydown="if(event.key==='Enter')girisYap()">
    <button class="login-btn" onclick="girisYap()">Giri≈ü Yap ‚Üí</button>
    <div class="login-error" id="loginHata">Hatalƒ± ≈üifre veya kasa se√ßilmedi</div>
  </div>
</div>

<div id="app">
  <header>
    <div class="header-left">
      <div class="brand">KASA Sƒ∞STEMƒ∞</div>
      <div id="headerBadge" class="header-kasa-badge"></div>
    </div>
    <div class="header-right">
      <div class="saat-blok">
        <div id="canliSaat" class="canli-saat">00:00:00</div>
        <div id="canliTarih" class="canli-tarih">00.00.0000</div>
      </div>
      <div class="sync-pill">
        <div class="sync-dot" id="syncDot"></div>
        <span id="syncText">BAƒûLANIYOR</span>
      </div>
      <button class="icon-btn" onclick="cikisYap()">√áƒ±kƒ±≈ü</button>
    </div>
  </header>

  <nav>
    <button class="nav-btn active" onclick="tabGec('kasa',this)">üí∞ Kasa ƒ∞≈ülemleri</button>
    <button class="nav-btn" onclick="tabGec('gecmis',this)">üìã Ge√ßmi≈ü</button>
    <button class="nav-btn" onclick="tabGec('rapor',this)">üìä G√ºn Sonu Raporu</button>
    <button class="nav-btn" onclick="tabGec('kullanici',this)">üë§ Kullanƒ±cƒ± Bilgileri</button>
    <button class="nav-btn" id="navAyarlar" style="display:none" onclick="tabGec('ayarlar',this)">‚öôÔ∏è Ayarlar</button>
  </nav>

  <main>
    <div class="tab-content active" id="tab-kasa">
      <div class="kasa-secim">
        <div class="kasa-kart kasa-baslik-kart kk-k1" id="kasaKart1">
          <div class="kasa-kart-header" style="margin-bottom:0">
            <div style="display:flex;align-items:center;gap:12px">
              <div class="kullanici-avatar av-k1" style="width:36px;height:36px;font-size:15px;flex-shrink:0">K</div>
              <div><div class="kasa-kart-isim">KASA 1</div><div class="kasa-kart-kisi">Kadir</div></div>
            </div>
            <div style="text-align:right">
              <div class="kasa-kart-tutar" id="kk1Tutar">‚Ç∫0,00</div>
              <div style="display:flex;gap:14px;margin-top:4px;justify-content:flex-end">
                <div class="kasa-mini km-giren" id="kk1Giren">‚Üë ‚Ç∫0,00</div>
                <div class="kasa-mini km-cikan" id="kk1Cikan">‚Üì ‚Ç∫0,00</div>
              </div>
            </div>
          </div>
        </div>
        <div class="kasa-kart kasa-baslik-kart kk-k2" id="kasaKart2">
          <div class="kasa-kart-header" style="margin-bottom:0">
            <div style="display:flex;align-items:center;gap:12px">
              <div class="kullanici-avatar av-k2" style="width:36px;height:36px;font-size:15px;flex-shrink:0">G</div>
              <div><div class="kasa-kart-isim">KASA 2</div><div class="kasa-kart-kisi">G√∂rkem</div></div>
            </div>
            <div style="text-align:right">
              <div class="kasa-kart-tutar" id="kk2Tutar">‚Ç∫0,00</div>
              <div style="display:flex;gap:14px;margin-top:4px;justify-content:flex-end">
                <div class="kasa-mini km-giren" id="kk2Giren">‚Üë ‚Ç∫0,00</div>
                <div class="kasa-mini km-cikan" id="kk2Cikan">‚Üì ‚Ç∫0,00</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="form-bar">
        <div class="form-bar-bolum tutar">
          <label class="field-label">TUTAR (TL)</label>
          <input type="number" class="field-input big" id="fTutar" placeholder="0,00" min="0" step="0.01" onkeydown="if(event.key==='Enter')document.getElementById('fAciklama').focus()">
        </div>
        <div class="form-bar-bolum aciklama">
          <label class="field-label">A√áIKLAMA</label>
          <input type="text" class="field-input" id="fAciklama" placeholder="ƒ∞≈ülem a√ßƒ±klamasƒ±...">
        </div>
        <div class="form-bar-btns">
          <button class="ekle-btn giren" id="btnGiren" onclick="islemEkle('giren')">‚Üë VEZNEYE Gƒ∞REN</button>
          <button class="ekle-btn cikan" id="btnCikan" onclick="islemEkle('cikan')">‚Üì VEZNEDEN √áIKAN</button>
        </div>
      </div>

      <div class="vezne-kasa-baslik" id="vezneBaslik">üí∞ Kasa ƒ∞≈ülemleri</div>
      <div class="vezne-tablo-wrap" id="vezneTablo">
        <div class="vezne-col vezne-giren">
          <div class="vezne-col-baslik">
            <span>‚Üë VEZNEYE Gƒ∞REN</span>
            <span class="vezne-toplam" id="girenToplam">‚Ç∫0,00</span>
          </div>
          <table class="vezne-tablo">
            <thead><tr><th>TUTAR</th><th>SAAT</th><th>A√áIKLAMA</th><th></th></tr></thead>
            <tbody id="girenTablo"><tr><td colspan="4" class="bos-msg">Bug√ºn giren yok</td></tr></tbody>
          </table>
        </div>
        <div class="vezne-ayrac"></div>
        <div class="vezne-col vezne-cikan">
          <div class="vezne-col-baslik">
            <span>‚Üì VEZNEDEN √áIKAN</span>
            <span class="vezne-toplam" id="cikanToplam">‚Ç∫0,00</span>
          </div>
          <table class="vezne-tablo">
            <thead><tr><th>TUTAR</th><th>SAAT</th><th>A√áIKLAMA</th><th></th></tr></thead>
            <tbody id="cikanTablo"><tr><td colspan="4" class="bos-msg">Bug√ºn √ßƒ±kan yok</td></tr></tbody>
          </table>
        </div>
      </div>

      <div class="hizli-fm-wrap" id="hizliFmWrap" style="margin-top:16px">
        <div class="hizli-fm-label">üì± FATURAMATƒ∞K KASASI</div>
        <div class="hizli-fm-row">
          <div class="hizli-fm-bolum" id="hizliFmKasiyerBlok">
            <label class="field-label" id="hizliFmLabel">BUG√úN√úN TUTARINI Gƒ∞Rƒ∞N</label>
            <input type="number" class="field-input big" id="hizliFmTutar" placeholder="0,00" step="0.01" min="0" oninput="hizliFmKarsilastir()">
          </div>
          <div class="hizli-fm-sonuc" id="hizliFmSonuc"></div>
        </div>
        <div class="fm-not-bolum">
          <label class="field-label" style="margin-bottom:6px;display:block">NOT / A√áIKLAMA</label>
          <textarea class="fm-not-input" id="fmNot" placeholder="G√ºn sonu notu, a√ßƒ±klama veya uyarƒ± yazƒ±n..."></textarea>
        </div>
      </div>
    </div>

    <div class="tab-content" id="tab-gecmis">
      <div class="tarih-filtre">
        <button class="filtre-btn active" onclick="filtreBugun(this)">Bug√ºn</button>
        <button class="filtre-btn" onclick="filtreHafta(this)">Bu Hafta</button>
        <button class="filtre-btn" onclick="filtreAy(this)">Bu Ay</button>
        <span style="color:var(--muted);font-size:13px;font-family:'IBM Plex Mono',monospace">‚Äî</span>
        <input type="date" id="filtreBaslangic">
        <span style="color:var(--muted);font-size:12px">‚Üí</span>
        <input type="date" id="filtreBitis">
        <button class="filtre-btn" onclick="renderGecmis()">Filtrele</button>
        <select id="filtreKasa" onchange="renderGecmis()" style="padding:8px 12px;border:2px solid var(--border);border-radius:10px;font-family:'Bricolage Grotesque',sans-serif;font-size:13px;color:var(--text);background:var(--surface);cursor:pointer;outline:none;">
          <option value="hepsi">T√ºm Kasalar</option>
          <option value="k1">Kasa 1 - Kadir</option>
          <option value="k2">Kasa 2 - G√∂rkem</option>
        </select>
      </div>
      <div class="rapor-tablo">
        <table>
          <thead><tr><th>TARƒ∞H / SAAT</th><th>KASA</th><th>T√úR</th><th>A√áIKLAMA</th><th>TUTAR</th><th></th></tr></thead>
          <tbody id="gecmisTablo"></tbody>
        </table>
      </div>
      <div style="margin-top:10px;font-family:'IBM Plex Mono',monospace;font-size:12px;color:var(--muted)" id="gecmisSayac"></div>
    </div>

    <div class="tab-content" id="tab-rapor">
      <div class="tarih-filtre" style="margin-bottom:20px">
        <label style="font-family:'IBM Plex Mono',monospace;font-size:11px;color:var(--muted);letter-spacing:2px;text-transform:uppercase">RAPOR TARƒ∞Hƒ∞:</label>
        <input type="date" id="raporTarih" onchange="raporGuncelle()">
        <button class="filtre-btn active" onclick="raporBugune()">Bug√ºn</button>
      </div>
      <div class="faturamatik-wrap" id="faturamatikWrap">
        <div class="faturamatik-kasa-blok" id="fmK1Blok">
          <div class="fm-baslik">
            <div class="kullanici-avatar av-k1" style="width:32px;height:32px;font-size:14px">K</div>
            <div><div class="fm-kasa-isim">KASA 1 ‚Äî KADƒ∞R</div><div class="fm-alt">Faturamatik Kasasƒ± Giri≈üi</div></div>
          </div>
          <div class="fm-input-row">
            <input type="number" class="fm-input" id="fmTutarK1" placeholder="0,00" step="0.01" min="0" oninput="fmKarsilastir()">
            <span class="fm-tl">‚Ç∫</span>
          </div>
          <div class="fm-sonuc" id="fmSonucK1"></div>
        </div>
        <div class="faturamatik-kasa-blok" id="fmK2Blok">
          <div class="fm-baslik">
            <div class="kullanici-avatar av-k2" style="width:32px;height:32px;font-size:14px">G</div>
            <div><div class="fm-kasa-isim">KASA 2 ‚Äî G√ñRKEM</div><div class="fm-alt">Faturamatik Kasasƒ± Giri≈üi</div></div>
          </div>
          <div class="fm-input-row">
            <input type="number" class="fm-input" id="fmTutarK2" placeholder="0,00" step="0.01" min="0" oninput="fmKarsilastir()">
            <span class="fm-tl">‚Ç∫</span>
          </div>
          <div class="fm-sonuc" id="fmSonucK2"></div>
        </div>
      </div>
      <div class="gunsonu-wrap" id="raporIcerik">
        <div style="grid-column:1/-1;text-align:center;color:var(--muted);padding:60px;font-family:'IBM Plex Mono',monospace;font-size:13px">Tarih se√ßin</div>
      </div>
    </div>

    <div class="tab-content" id="tab-kullanici">
      <div class="kullanici-grid">
        <div class="kullanici-kart">
          <h3><div class="kullanici-avatar av-k1">K</div>Kadir ‚Äî Kasa 1</h3>
          <div class="kullanici-bilgi-row"><span class="kb-label">BA≈ûLANGI√á PARASI</span><span class="kb-val">‚Ç∫0,00</span></div>
          <div class="kullanici-bilgi-row"><span class="kb-label">BUG√úN Gƒ∞REN</span><span class="kb-val" id="uKadir1" style="color:var(--giren)">‚Ç∫0</span></div>
          <div class="kullanici-bilgi-row"><span class="kb-label">BUG√úN √áIKAN</span><span class="kb-val" id="uKadir2" style="color:var(--cikan)">‚Ç∫0</span></div>
          <div class="kullanici-bilgi-row"><span class="kb-label">KASADA TOPLAM</span><span class="kb-val" id="uKadir3" style="color:var(--gold)">‚Ç∫0</span></div>
          <div class="kullanici-bilgi-row"><span class="kb-label">BUG√úN ƒ∞≈ûLEM SAYISI</span><span class="kb-val" id="uKadir4">0 i≈ülem</span></div>
        </div>
        <div class="kullanici-kart">
          <h3><div class="kullanici-avatar av-k2">G</div>G√∂rkem ‚Äî Kasa 2</h3>
          <div class="kullanici-bilgi-row"><span class="kb-label">BA≈ûLANGI√á PARASI</span><span class="kb-val">‚Ç∫0,00</span></div>
          <div class="kullanici-bilgi-row"><span class="kb-label">BUG√úN Gƒ∞REN</span><span class="kb-val" id="uGorkem1" style="color:var(--giren)">‚Ç∫0</span></div>
          <div class="kullanici-bilgi-row"><span class="kb-label">BUG√úN √áIKAN</span><span class="kb-val" id="uGorkem2" style="color:var(--cikan)">‚Ç∫0</span></div>
          <div class="kullanici-bilgi-row"><span class="kb-label">KASADA TOPLAM</span><span class="kb-val" id="uGorkem3" style="color:var(--gold)">‚Ç∫0</span></div>
          <div class="kullanici-bilgi-row"><span class="kb-label">BUG√úN ƒ∞≈ûLEM SAYISI</span><span class="kb-val" id="uGorkem4">0 i≈ülem</span></div>
        </div>
        <div class="ulke-history">
          <h3>Son ƒ∞≈ülem Aktivitesi</h3>
          <div id="aktiviteListesi"><div class="bos-msg">Y√ºkleniyor...</div></div>
        </div>
      </div>
    </div>

    <div class="tab-content" id="tab-ayarlar">
      <div class="ayarlar-wrap">
        <div class="ayarlar-kart">
          <h3 class="ayarlar-baslik">üîë Kasa 1 ‚Äî Kasiyer Bilgileri</h3>
          <div class="ayarlar-form">
            <div class="ayarlar-field"><label class="field-label">KASƒ∞YER ADI</label><input type="text" class="field-input" id="aK1Isim" placeholder="Kadir"></div>
            <div class="ayarlar-field"><label class="field-label">Gƒ∞Rƒ∞≈û ≈ûƒ∞FRESƒ∞</label><input type="text" class="field-input" id="aK1Sifre" placeholder="kadir"></div>
          </div>
          <button class="ayarlar-kaydet-btn k1-btn" onclick="ayarKaydet('k1')">Kaydet</button>
          <div class="ayarlar-bilgi" id="aK1Bilgi"></div>
        </div>
        <div class="ayarlar-kart">
          <h3 class="ayarlar-baslik">üîë Kasa 2 ‚Äî Kasiyer Bilgileri</h3>
          <div class="ayarlar-form">
            <div class="ayarlar-field"><label class="field-label">KASƒ∞YER ADI</label><input type="text" class="field-input" id="aK2Isim" placeholder="G√∂rkem"></div>
            <div class="ayarlar-field"><label class="field-label">Gƒ∞Rƒ∞≈û ≈ûƒ∞FRESƒ∞</label><input type="text" class="field-input" id="aK2Sifre" placeholder="gorkem"></div>
          </div>
          <button class="ayarlar-kaydet-btn k2-btn" onclick="ayarKaydet('k2')">Kaydet</button>
          <div class="ayarlar-bilgi" id="aK2Bilgi"></div>
        </div>
        <div class="ayarlar-kart" style="grid-column:1/-1">
          <h3 class="ayarlar-baslik">üîê Y√∂netici ≈ûifresi</h3>
          <div class="ayarlar-form">
            <div class="ayarlar-field"><label class="field-label">YENƒ∞ Y√ñNETƒ∞Cƒ∞ ≈ûƒ∞FRESƒ∞</label><input type="text" class="field-input" id="aAdminSifre" placeholder="dmn"></div>
            <div class="ayarlar-field"><label class="field-label">ƒ∞≈ûLEM Sƒ∞LME ≈ûƒ∞FRESƒ∞</label><input type="text" class="field-input" id="aSilSifre" placeholder="dmn"></div>
          </div>
          <button class="ayarlar-kaydet-btn" style="background:var(--text);color:var(--bg)" onclick="ayarKaydet('admin')">Kaydet</button>
          <div class="ayarlar-bilgi" id="aAdminBilgi"></div>
        </div>
        <div class="ayarlar-kart" style="grid-column:1/-1">
          <h3 class="ayarlar-baslik">‚è±Ô∏è Otomatik Kilit S√ºresi</h3>
          <p style="font-size:13px;color:var(--muted);margin-bottom:16px;font-family:'IBM Plex Mono',monospace">Kullanƒ±cƒ± hareketsiz kalƒ±rsa ekran otomatik kilitlenir.</p>
          <div class="ayarlar-form" style="grid-template-columns:1fr 1fr 1fr;max-width:600px">
            <div class="ayarlar-field"><label class="field-label">Kƒ∞Lƒ∞T S√úRESƒ∞ (DAKƒ∞KA)</label><input type="number" class="field-input big" id="aKilitSure" placeholder="12" min="1" max="120" step="1"></div>
            <div class="ayarlar-field" style="justify-content:flex-end">
              <label class="field-label" style="opacity:0">_</label>
              <div style="display:flex;gap:8px;flex-wrap:wrap">
                <button class="kilit-sure-btn" onclick="hizliSure(5)">5 dk</button>
                <button class="kilit-sure-btn" onclick="hizliSure(10)">10 dk</button>
                <button class="kilit-sure-btn" onclick="hizliSure(12)">12 dk</button>
                <button class="kilit-sure-btn" onclick="hizliSure(30)">30 dk</button>
                <button class="kilit-sure-btn" onclick="hizliSure(60)">60 dk</button>
              </div>
            </div>
            <div class="ayarlar-field" style="justify-content:flex-end">
              <label class="field-label" style="opacity:0">_</label>
              <div style="font-family:'IBM Plex Mono',monospace;font-size:12px;color:var(--muted)">Aktif: <span id="aktifKilitSure" style="color:var(--text);font-weight:700">12 dk</span></div>
            </div>
          </div>
          <button class="ayarlar-kaydet-btn" style="background:var(--gold);color:white;margin-top:8px" onclick="ayarKaydet('kilit')">Kaydet</button>
          <div class="ayarlar-bilgi" id="aKilitBilgi"></div>
        </div>
      </div>
    </div>
  </main>
</div>

<div class="modal-overlay" id="kilitEkrani" style="display:none;z-index:9997">
  <div class="modal" style="text-align:center">
    <div style="font-size:40px;margin-bottom:12px">üîí</div>
    <h3 style="margin-bottom:8px">Oturum Kilitlendi</h3>
    <p style="margin-bottom:20px">Devam etmek i√ßin ≈üifrenizi girin.</p>
    <label class="field-label" style="text-align:left;display:block">≈ûƒ∞FRE</label>
    <input type="password" class="field-input" id="kilitSifre" placeholder="" style="margin-top:6px;letter-spacing:3px;font-size:18px" onkeydown="if(event.key==='Enter')kilitAc()">
    <div style="color:var(--cikan);font-size:12px;margin-top:8px;font-family:'IBM Plex Mono',monospace;display:none" id="kilitHata">Hatalƒ± ≈üifre!</div>
    <button class="login-btn" style="margin-top:16px" onclick="kilitAc()">Devam Et ‚Üí</button>
  </div>
</div>

<div class="modal-overlay" id="silModal" style="display:none">
  <div class="modal">
    <h3>üîê ƒ∞≈ülem Sil</h3>
    <p>Silmek i√ßin y√∂netici ≈üifresi gereklidir.</p>
    <label class="field-label">Y√ñNETƒ∞Cƒ∞ ≈ûƒ∞FRESƒ∞</label>
    <input type="password" class="field-input" id="silSifre" placeholder="" onkeydown="if(event.key==='Enter')silOnayla()" style="margin-top:6px">
    <div style="color:var(--k1);font-size:12px;margin-top:8px;font-family:'IBM Plex Mono',monospace;display:none" id="silHata">Hatalƒ± ≈üifre!</div>
    <div class="modal-btns">
      <button class="modal-iptal" onclick="silKapat()">ƒ∞ptal</button>
      <button class="modal-onayla" onclick="silOnayla()">Sil</button>
    </div>
  </div>
</div>

<script>
const BASLANGIC = 0;
let SIFRELER = { k1:'kadir', k2:'gorkem', admin:'dmn', sil:'dmn' };
let ISIMLER = { k1:'Kadir', k2:'G√∂rkem' };
let aktifKasa = 'k1';
let aktifKullanici = null;
let isAdmin = false;
let silPending = null;
let KILIT_SURE = 12 * 60 * 1000;
let kilitTimer = null;

window.islemler = [];
window.appBasladi = false;
window.renderHepsi = renderHepsi;

function bugunStr() { return new Date().toISOString().split('T')[0]; }
function simdi() { return new Date().toLocaleString('tr-TR'); }

let secilenKasa = null;
function seciKasa(k, el) {
  secilenKasa = k;
  document.querySelectorAll('.login-kasa-btn').forEach(b => b.classList.remove('selected'));
  el.classList.add('selected');
}
function girisYap() {
  const sifre = document.getElementById('loginSifre').value.trim();
  const hata = document.getElementById('loginHata');
  hata.style.display = 'none';
  if (!secilenKasa) { hata.textContent='L√ºtfen bir kasa se√ßin'; hata.style.display='block'; return; }
  if (sifre !== SIFRELER[secilenKasa]) { hata.textContent='Hatalƒ± ≈üifre!'; hata.style.display='block'; return; }
  if (secilenKasa === 'admin') { aktifKullanici='admin'; aktifKasa='k1'; isAdmin=true; }
  else { aktifKullanici=secilenKasa; aktifKasa=secilenKasa; isAdmin=false; }
  baslatApp();
}
function baslatApp() {
  document.getElementById('loginScreen').style.display = 'none';
  document.getElementById('app').style.display = 'block';
  const badge = document.getElementById('headerBadge');
  if (isAdmin) {
    badge.className='header-kasa-badge k1';
    badge.innerHTML='<div class="dot"></div> Y√ñNETƒ∞Cƒ∞';
    document.getElementById('kasaKart1').style.display = '';
    document.getElementById('kasaKart2').style.display = '';
    document.querySelector('.kasa-secim').style.gridTemplateColumns = '1fr 1fr';
    document.getElementById('kasaKart1').style.cursor = 'pointer';
    document.getElementById('kasaKart2').style.cursor = 'pointer';
    document.getElementById('kasaKart1').onclick = function(){ kasaSecKart(1); };
    document.getElementById('kasaKart2').onclick = function(){ kasaSecKart(2); };
    document.getElementById('hizliFmWrap').style.display = 'none';
    document.getElementById('faturamatikWrap').style.display = 'none';
  } else {
    badge.className=`header-kasa-badge ${aktifKasa}`;
    badge.innerHTML=`<div class="dot"></div> ${aktifKasa==='k1'?'KASƒ∞YER: KADƒ∞R':'KASƒ∞YER: G√ñRKEM'}`;
    document.getElementById('kasaKart1').style.display = aktifKasa==='k1' ? '' : 'none';
    document.getElementById('kasaKart2').style.display = aktifKasa==='k2' ? '' : 'none';
    document.querySelector('.kasa-secim').style.gridTemplateColumns = '1fr';
    document.querySelector('.kasa-secim').style.maxWidth = '480px';
    document.getElementById('fmK1Blok').style.display = aktifKasa==='k1' ? '' : 'none';
    document.getElementById('fmK2Blok').style.display = aktifKasa==='k2' ? '' : 'none';
    document.getElementById('faturamatikWrap').style.gridTemplateColumns = '1fr';
    document.getElementById('faturamatikWrap').style.maxWidth = '500px';
    const kasaIsmi = aktifKasa==='k1' ? 'KADƒ∞R' : 'G√ñRKEM';
    document.getElementById('hizliFmLabel').textContent = kasaIsmi + ' ‚Äî FATURAMATƒ∞K KASASI';
  }
  kasaSecKart(aktifKasa==='k1'?1:2);
  const bugun = bugunStr();
  document.getElementById('filtreBaslangic').value = bugun;
  document.getElementById('filtreBitis').value = bugun;
  document.getElementById('raporTarih').value = bugun;
  document.getElementById('navAyarlar').style.display = isAdmin ? '' : 'none';
  window.appBasladi = true;
  raporGuncelle();
  if (isAdmin) ayarlariDoldur();
  kilitSayacBaslat();
}
function cikisYap() { if(confirm('√áƒ±kƒ±≈ü yapƒ±lsƒ±n mƒ±?')) location.reload(); }

function kilitSayacBaslat() { clearTimeout(kilitTimer); kilitTimer = setTimeout(kilitEkraniGoster, KILIT_SURE); }
function kilitSayacSifirla() {
  if (!window.appBasladi) return;
  if (document.getElementById('kilitEkrani').style.display !== 'none') return;
  kilitSayacBaslat();
}
function kilitEkraniGoster() {
  document.getElementById('kilitEkrani').style.display = 'flex';
  document.getElementById('kilitSifre').value = '';
  document.getElementById('kilitHata').style.display = 'none';
  setTimeout(() => document.getElementById('kilitSifre').focus(), 100);
}
function kilitAc() {
  const sifre = document.getElementById('kilitSifre').value.trim();
  const hata = document.getElementById('kilitHata');
  if (sifre !== SIFRELER[aktifKullanici] && sifre !== SIFRELER.admin) { hata.style.display='block'; return; }
  hata.style.display = 'none';
  document.getElementById('kilitEkrani').style.display = 'none';
  kilitSayacBaslat();
}
['mousemove','keydown','click','touchstart','scroll'].forEach(e => {
  document.addEventListener(e, kilitSayacSifirla, { passive: true });
});

function saatiGuncelle() {
  const now = new Date();
  const gunler = ['Pazar','Pazartesi','Salƒ±','√áar≈üamba','Per≈üembe','Cuma','Cumartesi'];
  document.getElementById('canliSaat').textContent = now.toLocaleTimeString('tr-TR');
  document.getElementById('canliTarih').textContent = gunler[now.getDay()] + ', ' + now.toLocaleDateString('tr-TR');
}
setInterval(saatiGuncelle, 1000);
saatiGuncelle();

function kasaSecKart(n) {
  const yeni = 'k'+n;
  if (!isAdmin && aktifKullanici !== yeni) { toast('Sadece kendi kasanƒ±za i≈ülem yapabilirsiniz','err'); return; }
  aktifKasa = yeni;
  document.getElementById('kasaKart1').className = 'kasa-kart kasa-baslik-kart kk-k1'+(aktifKasa==='k1'?' active-k1':'');
  document.getElementById('kasaKart2').className = 'kasa-kart kasa-baslik-kart kk-k2'+(aktifKasa==='k2'?' active-k2':'');
  const kasaIsmi = aktifKasa==='k1' ? (ISIMLER.k1||'Kadir') : (ISIMLER.k2||'G√∂rkem');
  const baslikEl = document.getElementById('vezneBaslik');
  if (baslikEl) baslikEl.textContent = 'üí∞ ' + kasaIsmi + ' ‚Äî Kasa ' + n + ' ƒ∞≈ülemleri';
  if (isAdmin) {
    const tablo = document.getElementById('vezneTablo');
    if (tablo) { tablo.style.borderColor = aktifKasa==='k1'?'var(--k1)':'var(--k2)'; tablo.style.boxShadow = aktifKasa==='k1'?'0 0 0 3px rgba(200,75,47,0.12)':'0 0 0 3px rgba(37,99,168,0.12)'; }
    if (baslikEl) baslikEl.style.color = aktifKasa==='k1'?'var(--k1)':'var(--k2)';
  }
  renderKasaTablosu();
}

async function islemEkle(tur) {
  const tutar = parseFloat(document.getElementById('fTutar').value);
  const aciklama = document.getElementById('fAciklama').value.trim();
  if (!tutar || tutar <= 0) { toast('Ge√ßerli tutar girin!','err'); return; }
  if (!aciklama) { toast('A√ßƒ±klama bo≈ü olamaz!','err'); return; }
  document.getElementById('btnGiren').disabled = true;
  document.getElementById('btnCikan').disabled = true;
  const islem = { id:Date.now(), kasa:aktifKasa, tur, tutar, aciklama, tarih:bugunStr(), saat:simdi(), kullanici:aktifKullanici };
  try {
    await window.fbIslemEkle(islem);
    document.getElementById('fTutar').value = '';
    document.getElementById('fAciklama').value = '';
    document.getElementById('fTutar').focus();
    toast(`‚Ç∫${para(tutar)} ${tur==='giren'?'vezneye eklendi':'vezneden √ßƒ±kƒ±ldƒ±'}`, 'ok');
  } catch(e) { toast('Kayƒ±t hatasƒ±!','err'); }
  document.getElementById('btnGiren').disabled = false;
  document.getElementById('btnCikan').disabled = false;
}

function islemSilIste(fbKey) {
  silPending = fbKey;
  document.getElementById('silSifre').value = '';
  document.getElementById('silHata').style.display = 'none';
  document.getElementById('silModal').style.display = 'flex';
  setTimeout(() => document.getElementById('silSifre').focus(), 100);
}
function silKapat() { silPending=null; document.getElementById('silModal').style.display='none'; }
async function silOnayla() {
  if (document.getElementById('silSifre').value.trim() !== SIFRELER.sil) { document.getElementById('silHata').style.display='block'; return; }
  try { await window.fbIslemSil(silPending); silKapat(); toast('ƒ∞≈ülem silindi','info'); }
  catch(e) { toast('Silme hatasƒ±!','err'); }
}

function renderHepsi() {
  renderKasaOzetleri(); renderKasaTablosu(); renderKullanici();
  const aktifTab = document.querySelector('.tab-content.active');
  if (aktifTab?.id==='tab-gecmis') renderGecmis();
  if (aktifTab?.id==='tab-rapor') raporGuncelle();
}
function kasaHesapla(kasa, tarih) {
  const list = window.islemler.filter(i => i.kasa===kasa && (!tarih||i.tarih===tarih));
  let g=0,c=0;
  list.forEach(i => { if(i.tur==='giren') g+=i.tutar; else c+=i.tutar; });
  return { giren:g, cikan:c, toplam:BASLANGIC+g-c, sayac:list.length };
}
function renderKasaOzetleri() {
  ['k1','k2'].forEach((k,idx) => {
    const {giren,cikan,toplam} = kasaHesapla(k, null);
    document.getElementById(`kk${idx+1}Tutar`).textContent = '‚Ç∫'+para(toplam);
    document.getElementById(`kk${idx+1}Giren`).textContent = '‚Üë ‚Ç∫'+para(giren);
    document.getElementById(`kk${idx+1}Cikan`).textContent = '‚Üì ‚Ç∫'+para(cikan);
  });
}
function renderKasaTablosu() {
  const bugun = bugunStr();
  const tumIslemler = window.islemler.filter(i => i.kasa===aktifKasa && i.tarih===bugun);
  const girenler = tumIslemler.filter(i => i.tur==='giren');
  const cikanlar = tumIslemler.filter(i => i.tur==='cikan');
  const gt = girenler.reduce((s,i)=>s+i.tutar,0);
  const ct = cikanlar.reduce((s,i)=>s+i.tutar,0);
  document.getElementById('girenToplam').textContent = '‚Ç∫'+para(gt);
  document.getElementById('cikanToplam').textContent = '‚Ç∫'+para(ct);
  const gTbody = document.getElementById('girenTablo');
  if (!girenler.length) { gTbody.innerHTML='<tr><td colspan="4" class="bos-msg">Bug√ºn giren yok</td></tr>'; }
  else { gTbody.innerHTML = girenler.map(i=>`<tr><td class="td-tutar">‚Ç∫${para(i.tutar)}</td><td class="td-saat">${saatAl(i.saat)}</td><td class="td-aciklama">${esc(i.aciklama)}<span class="islem-kullanici">${kullaniciIsmi(i.kullanici)}</span></td><td><button class="sil-btn" onclick="islemSilIste('${i.fbKey}')">Sil</button></td></tr>`).join('') + `<tr class="toplam-satir toplam-giren"><td class="td-tutar toplam-tutar" colspan="2">TOPLAM: ‚Ç∫${para(gt)}</td><td colspan="2"></td></tr>`; }
  const cTbody = document.getElementById('cikanTablo');
  if (!cikanlar.length) { cTbody.innerHTML='<tr><td colspan="4" class="bos-msg">Bug√ºn √ßƒ±kan yok</td></tr>'; }
  else { cTbody.innerHTML = cikanlar.map(i=>`<tr><td class="td-tutar">‚Ç∫${para(i.tutar)}</td><td class="td-saat">${saatAl(i.saat)}</td><td class="td-aciklama">${esc(i.aciklama)}<span class="islem-kullanici">${kullaniciIsmi(i.kullanici)}</span></td><td><button class="sil-btn" onclick="islemSilIste('${i.fbKey}')">Sil</button></td></tr>`).join('') + `<tr class="toplam-satir toplam-cikan"><td class="td-tutar toplam-tutar" colspan="2">TOPLAM: ‚Ç∫${para(ct)}</td><td colspan="2"></td></tr>`; }
}
function renderGecmis() {
  const bas = document.getElementById('filtreBaslangic').value||bugunStr();
  const bit = document.getElementById('filtreBitis').value||bugunStr();
  const kasaF = document.getElementById('filtreKasa')?.value||'hepsi';
  const liste = window.islemler.filter(i=>i.tarih>=bas&&i.tarih<=bit&&(kasaF==='hepsi'||i.kasa===kasaF));
  document.getElementById('gecmisSayac').textContent = liste.length+' kayƒ±t';
  const tbody = document.getElementById('gecmisTablo');
  if (!liste.length) { tbody.innerHTML='<tr><td colspan="6" style="text-align:center;color:var(--muted);padding:32px;font-size:12px">Kayƒ±t bulunamadƒ±</td></tr>'; return; }
  tbody.innerHTML = liste.map(i=>`<tr><td>${i.saat}</td><td><span class="badge badge-${i.kasa}">${i.kasa==='k1'?'KADƒ∞R':'G√ñRKEM'}</span></td><td><span class="badge ${i.tur==='giren'?'badge-giren':'badge-cikan'}">${i.tur==='giren'?'Gƒ∞REN':'√áIKAN'}</span></td><td>${esc(i.aciklama)}</td><td style="font-family:'IBM Plex Mono',monospace;font-weight:700;color:${i.tur==='giren'?'var(--giren)':'var(--cikan)'}">${i.tur==='giren'?'+':'-'}‚Ç∫${para(i.tutar)}</td><td><button class="sil-btn" style="opacity:1" onclick="islemSilIste('${i.fbKey}')">Sil</button></td></tr>`).join('');
}
function renderKullanici() {
  const bugun = bugunStr();
  ['k1','k2'].forEach((k,idx) => {
    const {giren,cikan,toplam,sayac} = kasaHesapla(k,bugun);
    const s = idx===0?'Kadir':'Gorkem';
    document.getElementById(`u${s}1`).textContent='‚Ç∫'+para(giren);
    document.getElementById(`u${s}2`).textContent='‚Ç∫'+para(cikan);
    document.getElementById(`u${s}3`).textContent='‚Ç∫'+para(toplam);
    document.getElementById(`u${s}4`).textContent=sayac+' i≈ülem';
  });
  const son = window.islemler.slice(0,15);
  const el = document.getElementById('aktiviteListesi');
  if (!son.length) { el.innerHTML='<div class="bos-msg">Aktivite yok</div>'; return; }
  el.innerHTML = son.map(i=>`<div class="activity-row"><div style="width:80px"><span class="badge badge-${i.kasa}">${i.kasa==='k1'?'KADƒ∞R':'G√ñRKEM'}</span></div><div style="flex:1;font-size:13px">${esc(i.aciklama)}</div><div style="font-family:'IBM Plex Mono',monospace;font-size:12px;color:${i.tur==='giren'?'var(--giren)':'var(--cikan)'}">${i.tur==='giren'?'+':'-'}‚Ç∫${para(i.tutar)}</div><div style="font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--muted);margin-left:12px">${saatAl(i.saat)}</div></div>`).join('');
}
function raporBugune() { document.getElementById('raporTarih').value=bugunStr(); raporGuncelle(); }
function raporGuncelle() {
  const tarih = document.getElementById('raporTarih').value;
  if (!tarih) return;
  const k1=kasaHesapla('k1',tarih), k2=kasaHesapla('k2',tarih);
  const gG=k1.giren+k2.giren, gC=k1.cikan+k2.cikan, gT=k1.toplam+k2.toplam;
  const tarihGoster = new Date(tarih+'T12:00:00').toLocaleDateString('tr-TR',{day:'numeric',month:'long',year:'numeric'});
  document.getElementById('raporIcerik').innerHTML=`<div class="gunsonu-kasa-ozet"><h3><div class="kullanici-avatar av-k1" style="width:32px;height:32px;font-size:14px">K</div>Kasa 1 ‚Äî Kadir</h3><div class="gs-satir"><span class="gs-label">Ba≈ülangƒ±√ß</span><span class="gs-val">‚Ç∫${para(BASLANGIC)}</span></div><div class="gs-satir"><span class="gs-label" style="color:var(--giren)">+ Giren</span><span class="gs-val" style="color:var(--giren)">‚Ç∫${para(k1.giren)}</span></div><div class="gs-satir"><span class="gs-label" style="color:var(--cikan)">‚àí √áƒ±kan</span><span class="gs-val" style="color:var(--cikan)">‚Ç∫${para(k1.cikan)}</span></div><div class="gs-satir"><span class="gs-label">ƒ∞≈ülem Sayƒ±sƒ±</span><span class="gs-val">${k1.sayac} adet</span></div><div class="gs-satir"><span class="gs-label">KAPANI≈û</span><span class="gs-val" style="color:var(--gold)">‚Ç∫${para(k1.toplam)}</span></div></div><div class="gunsonu-kasa-ozet"><h3><div class="kullanici-avatar av-k2" style="width:32px;height:32px;font-size:14px">G</div>Kasa 2 ‚Äî G√∂rkem</h3><div class="gs-satir"><span class="gs-label">Ba≈ülangƒ±√ß</span><span class="gs-val">‚Ç∫${para(BASLANGIC)}</span></div><div class="gs-satir"><span class="gs-label" style="color:var(--giren)">+ Giren</span><span class="gs-val" style="color:var(--giren)">‚Ç∫${para(k2.giren)}</span></div><div class="gs-satir"><span class="gs-label" style="color:var(--cikan)">‚àí √áƒ±kan</span><span class="gs-val" style="color:var(--cikan)">‚Ç∫${para(k2.cikan)}</span></div><div class="gs-satir"><span class="gs-label">ƒ∞≈ülem Sayƒ±sƒ±</span><span class="gs-val">${k2.sayac} adet</span></div><div class="gs-satir"><span class="gs-label">KAPANI≈û</span><span class="gs-val" style="color:var(--gold)">‚Ç∫${para(k2.toplam)}</span></div></div><div class="gunsonu-kasa-ozet" style="grid-column:1/-1;border:2px solid var(--gold)"><h3>üìä ${tarihGoster} ‚Äî Genel √ñzet</h3><div class="gs-satir"><span class="gs-label" style="color:var(--giren)">+ Toplam Giren</span><span class="gs-val" style="color:var(--giren)">‚Ç∫${para(gG)}</span></div><div class="gs-satir"><span class="gs-label" style="color:var(--cikan)">‚àí Toplam √áƒ±kan</span><span class="gs-val" style="color:var(--cikan)">‚Ç∫${para(gC)}</span></div><div class="gs-satir"><span class="gs-label">G√úN SONU TOPLAM</span><span class="gs-val" style="color:var(--gold);font-size:20px">‚Ç∫${para(gT)}</span></div></div><div class="rapor-tablo" style="grid-column:1/-1"><table><thead><tr><th>SAAT</th><th>KASA</th><th>T√úR</th><th>A√áIKLAMA</th><th>TUTAR</th></tr></thead><tbody>${window.islemler.filter(i=>i.tarih===tarih).map(i=>`<tr><td>${saatAl(i.saat)}</td><td><span class="badge badge-${i.kasa}">${i.kasa==='k1'?'KADƒ∞R':'G√ñRKEM'}</span></td><td><span class="badge ${i.tur==='giren'?'badge-giren':'badge-cikan'}">${i.tur==='giren'?'Gƒ∞REN':'√áIKAN'}</span></td><td>${esc(i.aciklama)}</td><td style="color:${i.tur==='giren'?'var(--giren)':'var(--cikan)'};font-weight:700">${i.tur==='giren'?'+':'-'}‚Ç∫${para(i.tutar)}</td></tr>`).join('')||'<tr><td colspan="5" style="text-align:center;color:var(--muted);padding:24px;font-size:12px">Bu tarihte i≈ülem yok</td></tr>'}</tbody></table></div>`;
}
function filtreBugun(el) { const b=bugunStr(); document.getElementById('filtreBaslangic').value=b; document.getElementById('filtreBitis').value=b; document.querySelectorAll('.filtre-btn').forEach(x=>x.classList.remove('active')); el.classList.add('active'); renderGecmis(); }
function filtreHafta(el) { const now=new Date(),mon=new Date(now); mon.setDate(now.getDate()-now.getDay()+1); document.getElementById('filtreBaslangic').value=mon.toISOString().split('T')[0]; document.getElementById('filtreBitis').value=bugunStr(); document.querySelectorAll('.filtre-btn').forEach(x=>x.classList.remove('active')); el.classList.add('active'); renderGecmis(); }
function filtreAy(el) { const now=new Date(); document.getElementById('filtreBaslangic').value=`${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-01`; document.getElementById('filtreBitis').value=bugunStr(); document.querySelectorAll('.filtre-btn').forEach(x=>x.classList.remove('active')); el.classList.add('active'); renderGecmis(); }
function tabGec(id, btn) { document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active')); document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active')); document.getElementById('tab-'+id).classList.add('active'); btn.classList.add('active'); if(id==='gecmis') renderGecmis(); if(id==='rapor') raporGuncelle(); if(id==='kullanici') renderKullanici(); }
function fmKarsilastir() {
  const tarih = document.getElementById('raporTarih').value||bugunStr();
  ['k1','k2'].forEach(k => {
    const inputEl = document.getElementById(k==='k1'?'fmTutarK1':'fmTutarK2');
    const sonucEl = document.getElementById(k==='k1'?'fmSonucK1':'fmSonucK2');
    const fmTutar = parseFloat(inputEl.value);
    if (isNaN(fmTutar)||inputEl.value==='') { sonucEl.className='fm-sonuc'; return; }
    const {giren,cikan} = kasaHesapla(k,tarih);
    const netKasa = giren-cikan, fark = fmTutar-netKasa, esit = Math.abs(fark)<0.01;
    sonucEl.className='fm-sonuc '+(esit?'esit':'fark');
    sonucEl.innerHTML=`<div class="fm-sonuc-satir"><span>Giren</span><span style="color:var(--giren)">+‚Ç∫${para(giren)}</span></div><div class="fm-sonuc-satir"><span>√áƒ±kan</span><span style="color:var(--cikan)">-‚Ç∫${para(cikan)}</span></div><div class="fm-sonuc-satir"><span>Net Kasa</span><span>‚Ç∫${para(netKasa)}</span></div><div class="fm-sonuc-satir"><span>Faturamatik</span><span>‚Ç∫${para(fmTutar)}</span></div><div class="fm-sonuc-satir"><span>${esit?'‚úÖ UYU≈ûUYOR':'‚ùå UYU≈ûMUYOR'}</span><span style="color:${esit?'var(--giren)':'var(--cikan)'};font-size:16px">${esit?'Kasa Tamam':'Fark: ‚Ç∫'+para(Math.abs(fark))}</span></div>`;
  });
}
function hizliFmKarsilastir() {
  const inputEl=document.getElementById('hizliFmTutar'), sonucEl=document.getElementById('hizliFmSonuc');
  const fmTutar=parseFloat(inputEl.value);
  if (isNaN(fmTutar)||inputEl.value==='') { sonucEl.className='hizli-fm-sonuc'; return; }
  const {giren,cikan}=kasaHesapla(aktifKasa,bugunStr()), netKasa=giren-cikan, fark=fmTutar-netKasa, esit=Math.abs(fark)<0.01;
  sonucEl.className='hizli-fm-sonuc '+(esit?'esit':'fark');
  sonucEl.innerHTML=`<div class="hizli-fm-satir"><span>Giren</span><span style="color:var(--giren)">+‚Ç∫${para(giren)}</span></div><div class="hizli-fm-satir"><span>√áƒ±kan</span><span style="color:var(--cikan)">-‚Ç∫${para(cikan)}</span></div><div class="hizli-fm-satir"><span>Net Kasa</span><span>‚Ç∫${para(netKasa)}</span></div><div class="hizli-fm-satir toplam"><span>${esit?'‚úÖ UYU≈ûUYOR':'‚ùå UYU≈ûMUYOR'}</span><span style="color:${esit?'var(--giren)':'var(--cikan)'}">${esit?'Kasa Tamam':'Fark: ‚Ç∫'+para(Math.abs(fark))}</span></div>`;
}
function ayarlariDoldur() {
  document.getElementById('aK1Isim').value=ISIMLER.k1;
  document.getElementById('aK1Sifre').value=SIFRELER.k1;
  document.getElementById('aK2Isim').value=ISIMLER.k2;
  document.getElementById('aK2Sifre').value=SIFRELER.k2;
  document.getElementById('aAdminSifre').value=SIFRELER.admin;
  document.getElementById('aSilSifre').value=SIFRELER.sil;
  const dk=Math.round(KILIT_SURE/60000);
  document.getElementById('aKilitSure').value=dk;
  document.getElementById('aktifKilitSure').textContent=dk+' dk';
}
async function ayarKaydet(tip) {
  let bilgiId, yeniSifreler={...SIFRELER}, yeniIsimler={...ISIMLER};
  if (tip==='k1') { const isim=document.getElementById('aK1Isim').value.trim(),sifre=document.getElementById('aK1Sifre').value.trim(); if(!isim||!sifre){ayarBilgi('aK1Bilgi','Ad ve ≈üifre bo≈ü olamaz!','err');return;} yeniIsimler.k1=isim;yeniSifreler.k1=sifre;bilgiId='aK1Bilgi'; }
  else if (tip==='k2') { const isim=document.getElementById('aK2Isim').value.trim(),sifre=document.getElementById('aK2Sifre').value.trim(); if(!isim||!sifre){ayarBilgi('aK2Bilgi','Ad ve ≈üifre bo≈ü olamaz!','err');return;} yeniIsimler.k2=isim;yeniSifreler.k2=sifre;bilgiId='aK2Bilgi'; }
  else if (tip==='admin') { const adminS=document.getElementById('aAdminSifre').value.trim(),silS=document.getElementById('aSilSifre').value.trim(); if(!adminS||!silS){ayarBilgi('aAdminBilgi','≈ûifreler bo≈ü olamaz!','err');return;} yeniSifreler.admin=adminS;yeniSifreler.sil=silS;bilgiId='aAdminBilgi'; }
  if (tip==='kilit') {
    const dakika=parseInt(document.getElementById('aKilitSure').value);
    if(!dakika||dakika<1||dakika>120){ayarBilgi('aKilitBilgi','Ge√ßerli bir s√ºre girin (1-120 dk)!','err');return;}
    try { await window.fbAyarKaydet({sifreler:SIFRELER,isimler:ISIMLER,kilitDakika:dakika}); KILIT_SURE=dakika*60*1000; kilitSayacBaslat(); document.getElementById('aktifKilitSure').textContent=dakika+' dk'; document.querySelectorAll('.kilit-sure-btn').forEach(b=>b.classList.remove('aktif')); ayarBilgi('aKilitBilgi','‚úÖ Kilit s√ºresi '+dakika+' dakika!','ok'); } catch(e){ayarBilgi('aKilitBilgi','‚ùå Kayƒ±t hatasƒ±!','err');}
    return;
  }
  try { await window.fbAyarKaydet({sifreler:yeniSifreler,isimler:yeniIsimler,kilitDakika:Math.round(KILIT_SURE/60000)}); SIFRELER=yeniSifreler;ISIMLER=yeniIsimler; ayarBilgi(bilgiId,'‚úÖ Kaydedildi!','ok'); } catch(e){ayarBilgi(bilgiId,'‚ùå Kayƒ±t hatasƒ±!','err');}
}
function hizliSure(dk) { document.getElementById('aKilitSure').value=dk; document.querySelectorAll('.kilit-sure-btn').forEach(b=>b.classList.toggle('aktif',b.textContent===dk+' dk')); }
function ayarBilgi(id,msg,tip) { const el=document.getElementById(id); el.textContent=msg; el.className='ayarlar-bilgi '+tip; setTimeout(()=>{el.className='ayarlar-bilgi';},3000); }
function kullaniciIsmi(k) { if(!k)return''; if(k==='admin')return'Y√∂netici'; if(k==='k1')return ISIMLER.k1||'Kadir'; if(k==='k2')return ISIMLER.k2||'G√∂rkem'; return k; }
function para(n) { return Number(n).toLocaleString('tr-TR',{minimumFractionDigits:2,maximumFractionDigits:2}); }
function esc(t) { return String(t).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
function saatAl(s) { return s?(s.includes(' ')?s.split(' ')[1]:s):''; }
function toast(msg,tip='ok') { const el=document.createElement('div'); el.className=`toast ${tip}`; el.textContent=msg; document.body.appendChild(el); setTimeout(()=>el.remove(),3000); }
</script>
</body>
</html>

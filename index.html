<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kasa Y√∂netim Sistemi</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;700&family=Bricolage+Grotesque:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<!-- ============================================================
     FIREBASE YAPILANDIRMASI
     A≈üaƒüƒ±daki firebaseConfig i√ßindeki deƒüerleri
     kendi Firebase projenizin deƒüerleriyle deƒüi≈ütirin.
     Firebase Console > Project Settings > Your apps > SDK setup
     ============================================================ -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getDatabase, ref, onValue, set, push, remove, get } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC5YLwaYF59p6QaQwZktgOt0fw3Y4gkfEo",
    authDomain: "kasa-programi-7fa8b.firebaseapp.com",
    databaseURL: "https://kasa-programi-7fa8b-default-rtdb.firebaseio.com",
    projectId: "kasa-programi-7fa8b",
    storageBucket: "kasa-programi-7fa8b.firebasestorage.app",
    messagingSenderId: "756803325479",
    appId: "1:756803325479:web:c5ba134d125c3930f50802",
    measurementId: "G-DFL17WR3M3"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const islemlerRef = ref(db, 'islemler');

  // Global eri≈üim i√ßin window'a ata
  window.fbDb = db;
  window.fbRef = ref;
  window.fbSet = set;
  window.fbPush = push;
  window.fbRemove = remove;
  window.fbGet = get;
  window.islemlerRef = islemlerRef;
  window.fbHazir = true;

  // Ger√ßek zamanlƒ± dinleme
  onValue(islemlerRef, (snapshot) => {
    const data = snapshot.val();
    window.islemler = data ? Object.entries(data).map(([fbKey, v]) => ({...v, fbKey})).sort((a,b) => b.id - a.id) : [];
    if (window.appBasladi) {
      window.renderHepsi();
      document.getElementById('syncText').textContent = 'CANLI';
      document.getElementById('syncDot').style.background = '#1a7a4a';
    }
  }, (error) => {
    document.getElementById('syncText').textContent = 'BAƒûLANTI YOK';
    document.getElementById('syncDot').style.background = '#c84b2f';
  });

  window.fbIslemEkle = async function(islem) {
    await push(islemlerRef, islem);
  };

  window.fbIslemSil = async function(fbKey) {
    await remove(ref(db, 'islemler/' + fbKey));
  };
</script>

<style>
:root {
  --bg: #f5f0e8;
  --bg2: #ede8dc;
  --surface: #ffffff;
  --border: #d4cfc4;
  --border2: #c4bfb4;
  --text: #1a1814;
  --muted: #8a8478;
  --k1: #c84b2f;
  --k1-light: rgba(200,75,47,0.1);
  --k2: #2563a8;
  --k2-light: rgba(37,99,168,0.1);
  --giren: #1a7a4a;
  --giren-light: rgba(26,122,74,0.1);
  --cikan: #c84b2f;
  --cikan-light: rgba(200,75,47,0.08);
  --gold: #b8860b;
  --shadow: 0 2px 12px rgba(0,0,0,0.08);
  --shadow-lg: 0 8px 32px rgba(0,0,0,0.12);
}
* { margin:0; padding:0; box-sizing:border-box; }
body {
  background: var(--bg);
  color: var(--text);
  font-family: 'Bricolage Grotesque', sans-serif;
  min-height: 100vh;
  background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23c4bfb4' fill-opacity='0.15'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
}

/* Gƒ∞Rƒ∞≈û */
#loginScreen {
  position:fixed; inset:0;
  background:var(--bg);
  display:flex; align-items:center; justify-content:center;
  z-index:9999;
}
.login-box {
  background:var(--surface);
  border:2px solid var(--border);
  border-radius:20px;
  padding:48px 40px;
  width:380px;
  text-align:center;
  box-shadow:var(--shadow-lg);
}
.login-logo { font-size:12px; font-family:'IBM Plex Mono',monospace; letter-spacing:4px; color:var(--muted); text-transform:uppercase; margin-bottom:8px; }
.login-title { font-size:28px; font-weight:800; margin-bottom:36px; }
.login-kasalar { display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:24px; }
.login-kasa-btn {
  padding:16px 12px;
  border:2px solid var(--border);
  border-radius:12px;
  background:transparent;
  cursor:pointer;
  font-family:'Bricolage Grotesque',sans-serif;
  transition:all 0.2s;
}
.login-kasa-btn .kasa-isim { font-size:10px; font-family:'IBM Plex Mono',monospace; letter-spacing:2px; text-transform:uppercase; color:var(--muted); margin-bottom:4px; }
.login-kasa-btn .kasa-kisi { font-size:18px; font-weight:700; }
.login-kasa-btn.k1 { border-color:var(--k1); }
.login-kasa-btn.k1 .kasa-kisi { color:var(--k1); }
.login-kasa-btn.k2 { border-color:var(--k2); }
.login-kasa-btn.k2 .kasa-kisi { color:var(--k2); }
.login-kasa-btn:hover { transform:translateY(-2px); box-shadow:var(--shadow); }
.login-kasa-btn.selected.k1 { background:var(--k1-light); }
.login-kasa-btn.selected.k2 { background:var(--k2-light); }
.login-sep { display:flex; align-items:center; gap:12px; margin-bottom:20px; }
.login-sep hr { flex:1; border:none; border-top:1px solid var(--border); }
.login-sep span { font-size:11px; color:var(--muted); font-family:'IBM Plex Mono',monospace; }
.login-input { width:100%; padding:14px 16px; border:2px solid var(--border); border-radius:12px; background:var(--bg); font-family:'IBM Plex Mono',monospace; font-size:16px; letter-spacing:4px; text-align:center; outline:none; transition:border-color 0.2s; margin-bottom:16px; }
.login-input:focus { border-color:var(--text); }
.login-btn { width:100%; padding:14px; border:none; border-radius:12px; background:var(--text); color:var(--bg); font-family:'Bricolage Grotesque',sans-serif; font-size:15px; font-weight:700; cursor:pointer; transition:all 0.2s; }
.login-btn:hover { background:#2a2520; transform:translateY(-1px); }
.login-error { color:var(--k1); font-size:12px; margin-top:12px; font-family:'IBM Plex Mono',monospace; display:none; }
.admin-link { margin-top:16px; font-size:12px; color:var(--muted); cursor:pointer; font-family:'IBM Plex Mono',monospace; text-decoration:underline; }

/* HEADER */
#app { display:none; }
header {
  background:var(--surface);
  border-bottom:2px solid var(--border);
  padding:0 28px;
  display:flex; align-items:center; justify-content:space-between;
  height:64px;
  position:sticky; top:0; z-index:100;
  box-shadow:0 2px 8px rgba(0,0,0,0.06);
}
.header-left { display:flex; align-items:center; gap:20px; }
.brand { font-family:'IBM Plex Mono',monospace; font-size:13px; font-weight:700; letter-spacing:3px; text-transform:uppercase; }
.header-kasa-badge { display:flex; align-items:center; gap:8px; padding:6px 14px; border-radius:20px; font-size:13px; font-weight:600; }
.header-kasa-badge.k1 { background:var(--k1-light); color:var(--k1); border:1px solid var(--k1); }
.header-kasa-badge.k2 { background:var(--k2-light); color:var(--k2); border:1px solid var(--k2); }
.header-kasa-badge .dot { width:8px; height:8px; border-radius:50%; background:currentColor; }
.header-right { display:flex; align-items:center; gap:12px; }
.sync-pill { display:flex; align-items:center; gap:6px; padding:5px 12px; background:var(--bg2); border:1px solid var(--border); border-radius:20px; font-family:'IBM Plex Mono',monospace; font-size:11px; color:var(--muted); }
.sync-dot { width:8px; height:8px; border-radius:50%; background:var(--giren); transition:background 0.3s; animation:pulse 2s infinite; }
@keyframes pulse { 0%,100%{opacity:1}50%{opacity:0.4} }
.icon-btn { padding:8px 14px; border:1px solid var(--border); border-radius:8px; background:transparent; color:var(--muted); font-family:'Bricolage Grotesque',sans-serif; font-size:13px; font-weight:500; cursor:pointer; transition:all 0.2s; }
.icon-btn:hover { border-color:var(--text); color:var(--text); }

/* NAV */
nav { display:flex; gap:4px; background:var(--bg2); border-bottom:2px solid var(--border); padding:0 28px; overflow-x:auto; }
.nav-btn { padding:14px 20px; border:none; background:transparent; font-family:'Bricolage Grotesque',sans-serif; font-size:13px; font-weight:600; color:var(--muted); cursor:pointer; border-bottom:3px solid transparent; margin-bottom:-2px; transition:all 0.2s; white-space:nowrap; }
.nav-btn:hover { color:var(--text); }
.nav-btn.active { color:var(--text); border-bottom-color:var(--text); }

main { max-width:1200px; margin:0 auto; padding:28px; }
.tab-content { display:none; }
.tab-content.active { display:block; }

/* KASA KARTLARI */
.kasa-secim { display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-bottom:28px; }
.kasa-kart { background:var(--surface); border:2px solid var(--border); border-radius:16px; padding:24px; cursor:pointer; transition:all 0.2s; }
.kasa-kart.active-k1 { border-color:var(--k1); box-shadow:0 0 0 4px var(--k1-light); }
.kasa-kart.active-k2 { border-color:var(--k2); box-shadow:0 0 0 4px var(--k2-light); }
.kasa-kart:hover { transform:translateY(-2px); box-shadow:var(--shadow); }
.kasa-kart-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:16px; }
.kasa-kart-isim { font-family:'IBM Plex Mono',monospace; font-size:10px; letter-spacing:3px; text-transform:uppercase; color:var(--muted); }
.kasa-kart-kisi { font-size:22px; font-weight:800; }
.kk-k1 .kasa-kart-kisi { color:var(--k1); }
.kk-k2 .kasa-kart-kisi { color:var(--k2); }
.kasa-kart-tutar { font-family:'IBM Plex Mono',monospace; font-size:28px; font-weight:700; }
.kasa-kart-alt { display:flex; gap:16px; margin-top:12px; }
.kasa-mini { font-family:'IBM Plex Mono',monospace; font-size:12px; }
.km-giren { color:var(--giren); }
.km-cikan { color:var(--cikan); }

/* FORM */
.islem-alani { display:grid; grid-template-columns:340px 1fr; gap:20px; }
.form-kart { background:var(--surface); border:2px solid var(--border); border-radius:16px; padding:24px; height:fit-content; }
.form-kart h3 { font-size:14px; font-weight:700; margin-bottom:20px; }
.tur-toggle { display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-bottom:20px; }
.tur-btn { padding:12px; border:2px solid var(--border); border-radius:10px; background:transparent; font-family:'Bricolage Grotesque',sans-serif; font-size:13px; font-weight:700; cursor:pointer; transition:all 0.2s; }
.tur-btn.active-giren { border-color:var(--giren); background:var(--giren-light); color:var(--giren); }
.tur-btn.active-cikan { border-color:var(--cikan); background:var(--cikan-light); color:var(--cikan); }
.tur-btn:not(.active-giren):not(.active-cikan) { color:var(--muted); }
.field-label { display:block; font-size:11px; font-weight:700; letter-spacing:2px; text-transform:uppercase; color:var(--muted); margin-bottom:7px; }
.field-input { width:100%; background:var(--bg); border:2px solid var(--border); border-radius:10px; padding:11px 14px; color:var(--text); font-family:'IBM Plex Mono',monospace; font-size:15px; margin-bottom:16px; outline:none; transition:border-color 0.2s; }
.field-input:focus { border-color:var(--text); }
.field-input.big { font-size:22px; font-weight:700; }
textarea.field-input { resize:none; height:72px; font-size:13px; font-family:'Bricolage Grotesque',sans-serif; }
.ekle-btn { width:100%; padding:13px; border:none; border-radius:10px; font-family:'Bricolage Grotesque',sans-serif; font-size:15px; font-weight:800; cursor:pointer; transition:all 0.2s; }
.ekle-btn.giren { background:var(--giren); color:white; }
.ekle-btn.cikan { background:var(--cikan); color:white; }
.ekle-btn:hover { transform:translateY(-1px); filter:brightness(1.05); box-shadow:var(--shadow); }
.ekle-btn:disabled { opacity:0.5; cursor:not-allowed; transform:none; }

/* Lƒ∞STE */
.gecmis-kart { background:var(--surface); border:2px solid var(--border); border-radius:16px; padding:24px; display:flex; flex-direction:column; max-height:600px; }
.gecmis-kart h3 { font-size:14px; font-weight:700; margin-bottom:16px; display:flex; align-items:center; justify-content:space-between; }
.islem-listesi { overflow-y:auto; flex:1; display:flex; flex-direction:column; gap:6px; }
.islem-listesi::-webkit-scrollbar { width:4px; }
.islem-listesi::-webkit-scrollbar-thumb { background:var(--border); border-radius:2px; }
.islem-row { display:flex; align-items:center; gap:12px; padding:10px 12px; background:var(--bg); border-radius:10px; border-left:3px solid transparent; animation:slideIn 0.25s ease; }
@keyframes slideIn { from{opacity:0;transform:translateX(-8px)} to{opacity:1;transform:none} }
.islem-row.giren { border-left-color:var(--giren); }
.islem-row.cikan { border-left-color:var(--cikan); }
.islem-row-ikon { font-size:14px; width:20px; text-align:center; }
.islem-row-info { flex:1; min-width:0; }
.islem-row-aciklama { font-size:13px; font-weight:600; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.islem-row-meta { font-family:'IBM Plex Mono',monospace; font-size:10px; color:var(--muted); margin-top:2px; }
.islem-row-tutar { font-family:'IBM Plex Mono',monospace; font-size:14px; font-weight:700; }
.islem-row.giren .islem-row-tutar { color:var(--giren); }
.islem-row.cikan .islem-row-tutar { color:var(--cikan); }
.islem-row-sil { padding:4px 8px; border:1px solid var(--border); border-radius:6px; background:transparent; color:var(--muted); font-size:11px; cursor:pointer; transition:all 0.2s; opacity:0; }
.islem-row:hover .islem-row-sil { opacity:1; }
.islem-row-sil:hover { border-color:var(--cikan); color:var(--cikan); background:var(--cikan-light); }
.bos-msg { text-align:center; color:var(--muted); padding:40px 20px; font-family:'IBM Plex Mono',monospace; font-size:13px; }

/* TARƒ∞H Fƒ∞LTRE */
.tarih-filtre { display:flex; align-items:center; gap:10px; margin-bottom:20px; flex-wrap:wrap; }
.tarih-filtre input[type="date"] { padding:8px 12px; border:2px solid var(--border); border-radius:10px; background:var(--surface); font-family:'IBM Plex Mono',monospace; font-size:13px; color:var(--text); outline:none; }
.tarih-filtre input[type="date"]:focus { border-color:var(--text); }
.filtre-btn { padding:8px 16px; border:2px solid var(--border); border-radius:10px; background:transparent; font-family:'Bricolage Grotesque',sans-serif; font-size:13px; font-weight:600; color:var(--muted); cursor:pointer; transition:all 0.2s; }
.filtre-btn:hover,.filtre-btn.active { border-color:var(--text); color:var(--text); background:var(--surface); }

/* RAPOR */
.gunsonu-wrap { display:grid; grid-template-columns:1fr 1fr; gap:20px; }
.gunsonu-kasa-ozet { background:var(--surface); border:2px solid var(--border); border-radius:16px; padding:28px; }
.gunsonu-kasa-ozet h3 { font-size:16px; font-weight:800; margin-bottom:20px; display:flex; align-items:center; gap:10px; }
.gs-satir { display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid var(--border); font-size:14px; }
.gs-satir:last-child { border-bottom:none; font-weight:800; font-size:16px; }
.gs-satir .gs-label { color:var(--muted); }
.gs-satir .gs-val { font-family:'IBM Plex Mono',monospace; font-weight:700; }
.rapor-tablo { background:var(--surface); border:2px solid var(--border); border-radius:14px; overflow:hidden; }
.rapor-tablo table { width:100%; border-collapse:collapse; font-size:13px; }
.rapor-tablo thead tr { background:var(--bg2); border-bottom:2px solid var(--border); }
.rapor-tablo th { padding:12px 16px; text-align:left; font-family:'IBM Plex Mono',monospace; font-size:10px; letter-spacing:2px; text-transform:uppercase; color:var(--muted); font-weight:500; }
.rapor-tablo td { padding:10px 16px; border-bottom:1px solid var(--border); font-family:'IBM Plex Mono',monospace; font-size:12px; }
.rapor-tablo tr:last-child td { border-bottom:none; }
.rapor-tablo tr:hover td { background:var(--bg2); }

/* KULLANICI */
.kullanici-grid { display:grid; grid-template-columns:1fr 1fr; gap:20px; }
.kullanici-kart { background:var(--surface); border:2px solid var(--border); border-radius:16px; padding:24px; }
.kullanici-kart h3 { display:flex; align-items:center; gap:10px; font-size:16px; font-weight:800; margin-bottom:20px; }
.kullanici-avatar { width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:16px; font-weight:800; color:white; }
.av-k1 { background:var(--k1); }
.av-k2 { background:var(--k2); }
.kullanici-bilgi-row { display:flex; justify-content:space-between; align-items:center; padding:10px 0; border-bottom:1px solid var(--border); font-size:13px; }
.kullanici-bilgi-row:last-child { border-bottom:none; }
.kb-label { color:var(--muted); font-family:'IBM Plex Mono',monospace; font-size:11px; }
.kb-val { font-weight:600; font-family:'IBM Plex Mono',monospace; font-size:13px; }
.ulke-history { margin-top:0; background:var(--surface); border:2px solid var(--border); border-radius:16px; padding:24px; grid-column:1/-1; }
.ulke-history h3 { font-size:14px; font-weight:700; margin-bottom:16px; }
.activity-row { display:flex; align-items:center; gap:12px; padding:8px 12px; background:var(--bg); border-radius:8px; margin-bottom:6px; font-size:13px; }
.activity-kasa { width:80px; }

/* MODAL */
.modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.5); display:flex; align-items:center; justify-content:center; z-index:9998; backdrop-filter:blur(4px); }
.modal { background:var(--surface); border:2px solid var(--border); border-radius:16px; padding:32px; width:360px; box-shadow:var(--shadow-lg); animation:modalIn 0.2s ease; }
@keyframes modalIn { from{opacity:0;transform:scale(0.95)} to{opacity:1;transform:none} }
.modal h3 { font-size:18px; font-weight:800; margin-bottom:8px; }
.modal p { font-size:13px; color:var(--muted); margin-bottom:20px; }
.modal-btns { display:flex; gap:10px; margin-top:20px; }
.modal-btns button { flex:1; padding:11px; border-radius:10px; font-family:'Bricolage Grotesque',sans-serif; font-size:14px; font-weight:700; cursor:pointer; transition:all 0.2s; border:2px solid var(--border); }
.modal-iptal { background:transparent; color:var(--muted); }
.modal-iptal:hover { border-color:var(--text); color:var(--text); }
.modal-onayla { background:var(--cikan); color:white; border-color:var(--cikan); }
.modal-onayla:hover { filter:brightness(1.1); }

/* TOAST */
.toast { position:fixed; bottom:24px; right:24px; padding:12px 20px; border-radius:12px; font-size:13px; font-weight:600; z-index:9999; animation:toastIn 0.3s ease; box-shadow:var(--shadow-lg); font-family:'IBM Plex Mono',monospace; }
.toast.ok { background:var(--giren); color:white; }
.toast.err { background:var(--cikan); color:white; }
.toast.info { background:var(--text); color:var(--bg); }
@keyframes toastIn { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:none} }

/* BADGE */
.badge { display:inline-flex; align-items:center; padding:3px 9px; border-radius:20px; font-size:10px; font-weight:700; font-family:'IBM Plex Mono',monospace; letter-spacing:1px; }
.badge-k1 { background:var(--k1-light); color:var(--k1); }
.badge-k2 { background:var(--k2-light); color:var(--k2); }
.badge-giren { background:var(--giren-light); color:var(--giren); }
.badge-cikan { background:var(--cikan-light); color:var(--cikan); }
::-webkit-scrollbar { width:6px; }
::-webkit-scrollbar-thumb { background:var(--border); border-radius:3px; }
</style>
</head>
<body>

<!-- Gƒ∞Rƒ∞≈û -->
<div id="loginScreen">
  <div class="login-box">
    <div class="login-logo">FATURA √ñDEME</div>
    <div class="login-title">Kasa Giri≈üi</div>
    <div class="login-kasalar">
      <button class="login-kasa-btn k1" onclick="seciKasa('k1',this)">
        <div class="kasa-isim">Kasa 1</div>
        <div class="kasa-kisi">Kadir</div>
      </button>
      <button class="login-kasa-btn k2" onclick="seciKasa('k2',this)">
        <div class="kasa-isim">Kasa 2</div>
        <div class="kasa-kisi">G√∂rkem</div>
      </button>
    </div>
    <div class="login-sep"><hr><span>≈ûƒ∞FRE</span><hr></div>
    <input type="password" class="login-input" id="loginSifre" placeholder="‚Ä¢ ‚Ä¢ ‚Ä¢ ‚Ä¢ ‚Ä¢ ‚Ä¢" maxlength="20" onkeydown="if(event.key==='Enter')girisYap()">
    <button class="login-btn" onclick="girisYap()">Giri≈ü Yap ‚Üí</button>
    <div class="login-error" id="loginHata">Hatalƒ± ≈üifre veya kasa se√ßilmedi</div>
    <div class="admin-link" onclick="adminGiris()">Y√∂netici Giri≈üi</div>
  </div>
</div>

<!-- ANA UYGULAMA -->
<div id="app">
  <header>
    <div class="header-left">
      <div class="brand">KASA Sƒ∞STEMƒ∞</div>
      <div id="headerBadge" class="header-kasa-badge"></div>
    </div>
    <div class="header-right">
      <div class="sync-pill">
        <div class="sync-dot" id="syncDot"></div>
        <span id="syncText">BAƒûLANIYOR</span>
      </div>
      <button class="icon-btn" onclick="cikisYap()">√áƒ±kƒ±≈ü</button>
    </div>
  </header>

  <nav>
    <button class="nav-btn active" onclick="tabGec('kasa',this)">üí∞ Kasa ƒ∞≈ülemleri</button>
    <button class="nav-btn" onclick="tabGec('gecmis',this)">üìã Ge√ßmi≈ü</button>
    <button class="nav-btn" onclick="tabGec('rapor',this)">üìä G√ºn Sonu Raporu</button>
    <button class="nav-btn" onclick="tabGec('kullanici',this)">üë§ Kullanƒ±cƒ± Bilgileri</button>
  </nav>

  <main>
    <!-- KASA ƒ∞≈ûLEMLERƒ∞ -->
    <div class="tab-content active" id="tab-kasa">
      <div class="kasa-secim">
        <div class="kasa-kart kk-k1" id="kasaKart1" onclick="kasaSecKart(1)">
          <div class="kasa-kart-header">
            <div><div class="kasa-kart-isim">KASA 1</div><div class="kasa-kart-kisi">Kadir</div></div>
            <span class="badge badge-k1" id="k1Badge"></span>
          </div>
          <div class="kasa-kart-tutar" id="kk1Tutar">‚Ç∫200,00</div>
          <div class="kasa-kart-alt">
            <div class="kasa-mini km-giren" id="kk1Giren">‚Üë ‚Ç∫0</div>
            <div class="kasa-mini km-cikan" id="kk1Cikan">‚Üì ‚Ç∫0</div>
          </div>
        </div>
        <div class="kasa-kart kk-k2" id="kasaKart2" onclick="kasaSecKart(2)">
          <div class="kasa-kart-header">
            <div><div class="kasa-kart-isim">KASA 2</div><div class="kasa-kart-kisi">G√∂rkem</div></div>
            <span class="badge badge-k2" id="k2Badge"></span>
          </div>
          <div class="kasa-kart-tutar" id="kk2Tutar">‚Ç∫200,00</div>
          <div class="kasa-kart-alt">
            <div class="kasa-mini km-giren" id="kk2Giren">‚Üë ‚Ç∫0</div>
            <div class="kasa-mini km-cikan" id="kk2Cikan">‚Üì ‚Ç∫0</div>
          </div>
        </div>
      </div>

      <div class="islem-alani">
        <div class="form-kart">
          <h3>Yeni ƒ∞≈ülem Ekle</h3>
          <div class="tur-toggle">
            <button class="tur-btn active-giren" id="turBtnGiren" onclick="setTur('giren')">‚Üë Gƒ∞REN</button>
            <button class="tur-btn" id="turBtnCikan" onclick="setTur('cikan')">‚Üì √áIKAN</button>
          </div>
          <label class="field-label">TUTAR (TL)</label>
          <input type="number" class="field-input big" id="fTutar" placeholder="0,00" min="0" step="0.01">
          <label class="field-label">A√áIKLAMA</label>
          <textarea class="field-input" id="fAciklama" placeholder="ƒ∞≈ülem a√ßƒ±klamasƒ±..."></textarea>
          <button class="ekle-btn giren" id="ekleBtn" onclick="islemEkle()">+ Gƒ∞REN EKLE</button>
        </div>
        <div class="gecmis-kart">
          <h3><span id="gecmisBaslik">Bug√ºn√ºn ƒ∞≈ülemleri</span></h3>
          <div class="islem-listesi" id="kasaIslemListesi"><div class="bos-msg">Y√ºkleniyor...</div></div>
        </div>
      </div>
    </div>

    <!-- GE√áMƒ∞≈û -->
    <div class="tab-content" id="tab-gecmis">
      <div class="tarih-filtre">
        <button class="filtre-btn active" onclick="filtreBugun(this)">Bug√ºn</button>
        <button class="filtre-btn" onclick="filtreHafta(this)">Bu Hafta</button>
        <button class="filtre-btn" onclick="filtreAy(this)">Bu Ay</button>
        <span style="color:var(--muted);font-size:13px;font-family:'IBM Plex Mono',monospace">‚Äî</span>
        <input type="date" id="filtreBaslangic">
        <span style="color:var(--muted);font-size:12px">‚Üí</span>
        <input type="date" id="filtreBitis">
        <button class="filtre-btn" onclick="renderGecmis()">Filtrele</button>
        <select id="filtreKasa" onchange="renderGecmis()" style="padding:8px 12px;border:2px solid var(--border);border-radius:10px;font-family:'Bricolage Grotesque',sans-serif;font-size:13px;color:var(--text);background:var(--surface);cursor:pointer;outline:none;">
          <option value="hepsi">T√ºm Kasalar</option>
          <option value="k1">Kasa 1 - Kadir</option>
          <option value="k2">Kasa 2 - G√∂rkem</option>
        </select>
      </div>
      <div class="gecmis-kart" style="max-height:none;">
        <h3><span>ƒ∞≈ülem Ge√ßmi≈üi</span><span id="gecmisSayac" style="font-size:12px;color:var(--muted);font-family:'IBM Plex Mono',monospace;font-weight:400"></span></h3>
        <div class="rapor-tablo">
          <table><thead><tr><th>TARƒ∞H / SAAT</th><th>KASA</th><th>T√úR</th><th>A√áIKLAMA</th><th>TUTAR</th><th>ƒ∞≈ûLEM</th></tr></thead>
          <tbody id="gecmisTablo"></tbody></table>
        </div>
      </div>
    </div>

    <!-- RAPOR -->
    <div class="tab-content" id="tab-rapor">
      <div class="tarih-filtre" style="margin-bottom:24px">
        <label style="font-family:'IBM Plex Mono',monospace;font-size:11px;color:var(--muted);letter-spacing:2px;text-transform:uppercase">RAPOR TARƒ∞Hƒ∞:</label>
        <input type="date" id="raporTarih" onchange="raporGuncelle()">
        <button class="filtre-btn active" onclick="raporBugune()">Bug√ºn</button>
      </div>
      <div class="gunsonu-wrap" id="raporIcerik">
        <div style="grid-column:1/-1;text-align:center;color:var(--muted);padding:60px;font-family:'IBM Plex Mono',monospace;font-size:13px">Tarih se√ßin</div>
      </div>
    </div>

    <!-- KULLANICI -->
    <div class="tab-content" id="tab-kullanici">
      <div class="kullanici-grid">
        <div class="kullanici-kart">
          <h3><div class="kullanici-avatar av-k1">K</div>Kadir ‚Äî Kasa 1</h3>
          <div class="kullanici-bilgi-row"><span class="kb-label">G√ñREV</span><span class="kb-val">Kasiyer</span></div>
          <div class="kullanici-bilgi-row"><span class="kb-label">BA≈ûLANGI√á PARASI</span><span class="kb-val">‚Ç∫200,00</span></div>
          <div class="kullanici-bilgi-row"><span class="kb-label">BUG√úN Gƒ∞REN</span><span class="kb-val" id="uKadir1" style="color:var(--giren)">‚Ç∫0</span></div>
          <div class="kullanici-bilgi-row"><span class="kb-label">BUG√úN √áIKAN</span><span class="kb-val" id="uKadir2" style="color:var(--cikan)">‚Ç∫0</span></div>
          <div class="kullanici-bilgi-row"><span class="kb-label">KASADA TOPLAM</span><span class="kb-val" id="uKadir3" style="color:var(--gold)">‚Ç∫200</span></div>
          <div class="kullanici-bilgi-row"><span class="kb-label">BUG√úN ƒ∞≈ûLEM SAYISI</span><span class="kb-val" id="uKadir4">0 i≈ülem</span></div>
        </div>
        <div class="kullanici-kart">
          <h3><div class="kullanici-avatar av-k2">G</div>G√∂rkem ‚Äî Kasa 2</h3>
          <div class="kullanici-bilgi-row"><span class="kb-label">G√ñREV</span><span class="kb-val">Kasiyer</span></div>
          <div class="kullanici-bilgi-row"><span class="kb-label">BA≈ûLANGI√á PARASI</span><span class="kb-val">‚Ç∫200,00</span></div>
          <div class="kullanici-bilgi-row"><span class="kb-label">BUG√úN Gƒ∞REN</span><span class="kb-val" id="uGorkem1" style="color:var(--giren)">‚Ç∫0</span></div>
          <div class="kullanici-bilgi-row"><span class="kb-label">BUG√úN √áIKAN</span><span class="kb-val" id="uGorkem2" style="color:var(--cikan)">‚Ç∫0</span></div>
          <div class="kullanici-bilgi-row"><span class="kb-label">KASADA TOPLAM</span><span class="kb-val" id="uGorkem3" style="color:var(--gold)">‚Ç∫200</span></div>
          <div class="kullanici-bilgi-row"><span class="kb-label">BUG√úN ƒ∞≈ûLEM SAYISI</span><span class="kb-val" id="uGorkem4">0 i≈ülem</span></div>
        </div>
        <div class="ulke-history">
          <h3>Son ƒ∞≈ülem Aktivitesi</h3>
          <div id="aktiviteListesi"><div class="bos-msg">Y√ºkleniyor...</div></div>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- Sƒ∞LME MODAL -->
<div class="modal-overlay" id="silModal" style="display:none">
  <div class="modal">
    <h3>üîê ƒ∞≈ülem Sil</h3>
    <p>Bu i≈ülemi silmek i√ßin y√∂netici ≈üifresi gereklidir.</p>
    <label class="field-label">Y√ñNETƒ∞Cƒ∞ ≈ûƒ∞FRESƒ∞</label>
    <input type="password" class="field-input" id="silSifre" placeholder="≈ûifre" onkeydown="if(event.key==='Enter')silOnayla()">
    <div class="login-error" id="silHata" style="display:none">Hatalƒ± ≈üifre!</div>
    <div class="modal-btns">
      <button class="modal-iptal" onclick="silKapat()">ƒ∞ptal</button>
      <button class="modal-onayla" onclick="silOnayla()">Sil</button>
    </div>
  </div>
</div>

<script>
const BASLANGIC = 200;
const SIFRELER = { k1: 'kadir', k2: 'gorkem', admin: 'dmn', sil: 'dmn' };

let aktifKasa = 'k1';
let aktifTur = 'giren';
let aktifKullanici = null;
let isAdmin = false;
let silPending = null;

// Firebase'den gelen islemler window.islemler'de tutulur
window.islemler = [];
window.appBasladi = false;
window.renderHepsi = renderHepsi;

function bugunStr() { return new Date().toISOString().split('T')[0]; }
function simdi() { return new Date().toLocaleString('tr-TR'); }

// Gƒ∞Rƒ∞≈û
let secilenKasa = null;
function seciKasa(k, el) {
  secilenKasa = k;
  document.querySelectorAll('.login-kasa-btn').forEach(b => b.classList.remove('selected'));
  el.classList.add('selected');
}
function girisYap() {
  const sifre = document.getElementById('loginSifre').value.trim();
  const hata = document.getElementById('loginHata');
  hata.style.display = 'none';
  if (!secilenKasa) { hata.textContent = 'L√ºtfen bir kasa se√ßin'; hata.style.display = 'block'; return; }
  if (sifre !== SIFRELER[secilenKasa]) { hata.textContent = 'Hatalƒ± ≈üifre!'; hata.style.display = 'block'; return; }
  aktifKullanici = secilenKasa;
  aktifKasa = secilenKasa;
  isAdmin = false;
  baslatApp();
}
function adminGiris() {
  const s = prompt('Y√∂netici ≈üifresi:');
  if (s === SIFRELER.admin) { aktifKullanici = 'admin'; aktifKasa = 'k1'; isAdmin = true; baslatApp(); }
  else alert('Hatalƒ± ≈üifre!');
}
function baslatApp() {
  document.getElementById('loginScreen').style.display = 'none';
  document.getElementById('app').style.display = 'block';
  const badge = document.getElementById('headerBadge');
  if (isAdmin) { badge.className = 'header-kasa-badge k1'; badge.innerHTML = '<div class="dot"></div> Y√ñNETƒ∞Cƒ∞'; }
  else { badge.className = `header-kasa-badge ${aktifKasa}`; badge.innerHTML = `<div class="dot"></div> ${aktifKasa==='k1'?'KASƒ∞YER: KADƒ∞R':'KASƒ∞YER: G√ñRKEM'}`; }
  kasaSecKart(aktifKasa === 'k1' ? 1 : 2);
  const bugun = bugunStr();
  document.getElementById('filtreBaslangic').value = bugun;
  document.getElementById('filtreBitis').value = bugun;
  document.getElementById('raporTarih').value = bugun;
  window.appBasladi = true;
  raporGuncelle();
}
function cikisYap() { if(confirm('√áƒ±kƒ±≈ü yapƒ±lsƒ±n mƒ±?')) location.reload(); }

// KASA SE√áƒ∞Mƒ∞
function kasaSecKart(n) {
  const yeni = 'k' + n;
  if (!isAdmin && aktifKullanici !== yeni) { toast('Sadece kendi kasanƒ±za i≈ülem yapabilirsiniz', 'err'); return; }
  aktifKasa = yeni;
  document.getElementById('kasaKart1').className = 'kasa-kart kk-k1' + (aktifKasa==='k1'?' active-k1':'');
  document.getElementById('kasaKart2').className = 'kasa-kart kk-k2' + (aktifKasa==='k2'?' active-k2':'');
  document.getElementById('gecmisBaslik').textContent = `${aktifKasa==='k1'?'Kasa 1 - Kadir':'Kasa 2 - G√∂rkem'} / Bug√ºn√ºn ƒ∞≈ülemleri`;
  renderKasaIslemleri();
}

// T√úR
function setTur(t) {
  aktifTur = t;
  document.getElementById('turBtnGiren').className = 'tur-btn'+(t==='giren'?' active-giren':'');
  document.getElementById('turBtnCikan').className = 'tur-btn'+(t==='cikan'?' active-cikan':'');
  const btn = document.getElementById('ekleBtn');
  btn.className = 'ekle-btn ' + t;
  btn.textContent = t==='giren'?'+ Gƒ∞REN EKLE':'‚àí √áIKAN EKLE';
}

// ƒ∞≈ûLEM EKLE
async function islemEkle() {
  const tutar = parseFloat(document.getElementById('fTutar').value);
  const aciklama = document.getElementById('fAciklama').value.trim();
  if (!tutar || tutar <= 0) { toast('Ge√ßerli tutar girin!','err'); return; }
  if (!aciklama) { toast('A√ßƒ±klama bo≈ü olamaz!','err'); return; }
  const btn = document.getElementById('ekleBtn');
  btn.disabled = true;
  const islem = { id: Date.now(), kasa: aktifKasa, tur: aktifTur, tutar, aciklama, tarih: bugunStr(), saat: simdi(), kullanici: aktifKullanici };
  try {
    await window.fbIslemEkle(islem);
    document.getElementById('fTutar').value = '';
    document.getElementById('fAciklama').value = '';
    toast(`‚Ç∫${para(tutar)} ${aktifTur==='giren'?'eklendi':'√ßƒ±kƒ±≈ü kaydedildi'}`, 'ok');
  } catch(e) { toast('Kayƒ±t hatasƒ±! Baƒülantƒ±yƒ± kontrol edin.', 'err'); }
  btn.disabled = false;
}

// Sƒ∞LME
function islemSilIste(fbKey) {
  silPending = fbKey;
  document.getElementById('silSifre').value = '';
  document.getElementById('silHata').style.display = 'none';
  document.getElementById('silModal').style.display = 'flex';
  setTimeout(() => document.getElementById('silSifre').focus(), 100);
}
function silKapat() { silPending = null; document.getElementById('silModal').style.display = 'none'; }
async function silOnayla() {
  if (document.getElementById('silSifre').value.trim() !== SIFRELER.sil) { document.getElementById('silHata').style.display = 'block'; return; }
  try {
    await window.fbIslemSil(silPending);
    silKapat();
    toast('ƒ∞≈ülem silindi', 'info');
  } catch(e) { toast('Silme hatasƒ±!', 'err'); }
}

// RENDER
function renderHepsi() {
  renderKasaOzetleri();
  renderKasaIslemleri();
  renderKullanici();
  // aktif sekmeye g√∂re
  const aktifTab = document.querySelector('.tab-content.active');
  if (aktifTab?.id === 'tab-gecmis') renderGecmis();
  if (aktifTab?.id === 'tab-rapor') raporGuncelle();
}

function kasaHesapla(kasa, tarih) {
  const list = window.islemler.filter(i => i.kasa===kasa && (!tarih || i.tarih===tarih));
  let g=0,c=0;
  list.forEach(i => { if(i.tur==='giren') g+=i.tutar; else c+=i.tutar; });
  return { giren:g, cikan:c, toplam:BASLANGIC+g-c, sayac:list.length };
}

function renderKasaOzetleri() {
  ['k1','k2'].forEach((k,idx) => {
    const {giren,cikan,toplam} = kasaHesapla(k, null);
    document.getElementById(`kk${idx+1}Tutar`).textContent = '‚Ç∫'+para(toplam);
    document.getElementById(`kk${idx+1}Giren`).textContent = '‚Üë ‚Ç∫'+para(giren);
    document.getElementById(`kk${idx+1}Cikan`).textContent = '‚Üì ‚Ç∫'+para(cikan);
  });
}

function renderKasaIslemleri() {
  const bugun = bugunStr();
  const list = window.islemler.filter(i => i.kasa===aktifKasa && i.tarih===bugun);
  const el = document.getElementById('kasaIslemListesi');
  if (!list.length) { el.innerHTML = '<div class="bos-msg">Bug√ºn i≈ülem yok</div>'; return; }
  el.innerHTML = list.map(i => `
    <div class="islem-row ${i.tur}">
      <div class="islem-row-ikon">${i.tur==='giren'?'‚Üë':'‚Üì'}</div>
      <div class="islem-row-info">
        <div class="islem-row-aciklama">${esc(i.aciklama)}</div>
        <div class="islem-row-meta">${i.saat}</div>
      </div>
      <div class="islem-row-tutar">${i.tur==='giren'?'+':'-'}‚Ç∫${para(i.tutar)}</div>
      <button class="islem-row-sil" onclick="islemSilIste('${i.fbKey}')">Sil</button>
    </div>
  `).join('');
}

function renderGecmis() {
  const bas = document.getElementById('filtreBaslangic').value || bugunStr();
  const bit = document.getElementById('filtreBitis').value || bugunStr();
  const kasaF = document.getElementById('filtreKasa')?.value || 'hepsi';
  const liste = window.islemler.filter(i => i.tarih>=bas && i.tarih<=bit && (kasaF==='hepsi'||i.kasa===kasaF));
  document.getElementById('gecmisSayac').textContent = liste.length + ' kayƒ±t';
  const tbody = document.getElementById('gecmisTablo');
  if (!liste.length) { tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;color:var(--muted);padding:32px;font-size:12px">Kayƒ±t bulunamadƒ±</td></tr>'; return; }
  tbody.innerHTML = liste.map(i => `
    <tr>
      <td>${i.saat}</td>
      <td><span class="badge badge-${i.kasa}">${i.kasa==='k1'?'KADƒ∞R':'G√ñRKEM'}</span></td>
      <td><span class="badge ${i.tur==='giren'?'badge-giren':'badge-cikan'}">${i.tur==='giren'?'Gƒ∞REN':'√áIKAN'}</span></td>
      <td>${esc(i.aciklama)}</td>
      <td style="color:${i.tur==='giren'?'var(--giren)':'var(--cikan)'}">${i.tur==='giren'?'+':'-'}‚Ç∫${para(i.tutar)}</td>
      <td><button class="islem-row-sil" style="opacity:1" onclick="islemSilIste('${i.fbKey}')">Sil</button></td>
    </tr>
  `).join('');
}

function renderKullanici() {
  const bugun = bugunStr();
  ['k1','k2'].forEach((k,idx) => {
    const {giren,cikan,toplam,sayac} = kasaHesapla(k, bugun);
    const s = idx===0?'Kadir':'Gorkem';
    document.getElementById(`u${s}1`).textContent = '‚Ç∫'+para(giren);
    document.getElementById(`u${s}2`).textContent = '‚Ç∫'+para(cikan);
    document.getElementById(`u${s}3`).textContent = '‚Ç∫'+para(toplam);
    document.getElementById(`u${s}4`).textContent = sayac+' i≈ülem';
  });
  const son = window.islemler.slice(0,15);
  const el = document.getElementById('aktiviteListesi');
  if (!son.length) { el.innerHTML = '<div class="bos-msg">Aktivite yok</div>'; return; }
  el.innerHTML = son.map(i => `
    <div class="activity-row">
      <div class="activity-kasa"><span class="badge badge-${i.kasa}">${i.kasa==='k1'?'KADƒ∞R':'G√ñRKEM'}</span></div>
      <div style="flex:1;font-size:13px">${esc(i.aciklama)}</div>
      <div style="font-family:'IBM Plex Mono',monospace;font-size:12px;color:${i.tur==='giren'?'var(--giren)':'var(--cikan)'}">
        ${i.tur==='giren'?'+':'-'}‚Ç∫${para(i.tutar)}
      </div>
      <div style="font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--muted);margin-left:12px">${i.saat}</div>
    </div>
  `).join('');
}

function raporBugune() { document.getElementById('raporTarih').value = bugunStr(); raporGuncelle(); }
function raporGuncelle() {
  const tarih = document.getElementById('raporTarih').value;
  if (!tarih) return;
  const k1 = kasaHesapla('k1',tarih), k2 = kasaHesapla('k2',tarih);
  const gG = k1.giren+k2.giren, gC = k1.cikan+k2.cikan, gT = k1.toplam+k2.toplam;
  const tarihGoster = new Date(tarih+'T12:00:00').toLocaleDateString('tr-TR',{day:'numeric',month:'long',year:'numeric'});
  document.getElementById('raporIcerik').innerHTML = `
    <div class="gunsonu-kasa-ozet">
      <h3><div class="kullanici-avatar av-k1" style="width:32px;height:32px;font-size:14px">K</div>Kasa 1 ‚Äî Kadir</h3>
      <div class="gs-satir"><span class="gs-label">Ba≈ülangƒ±√ß Parasƒ±</span><span class="gs-val">‚Ç∫${para(BASLANGIC)}</span></div>
      <div class="gs-satir"><span class="gs-label" style="color:var(--giren)">+ Giren</span><span class="gs-val" style="color:var(--giren)">‚Ç∫${para(k1.giren)}</span></div>
      <div class="gs-satir"><span class="gs-label" style="color:var(--cikan)">‚àí √áƒ±kan</span><span class="gs-val" style="color:var(--cikan)">‚Ç∫${para(k1.cikan)}</span></div>
      <div class="gs-satir"><span class="gs-label">ƒ∞≈ülem Sayƒ±sƒ±</span><span class="gs-val">${k1.sayac} adet</span></div>
      <div class="gs-satir"><span class="gs-label">KAPANI≈û BAKƒ∞YESƒ∞</span><span class="gs-val" style="color:var(--gold)">‚Ç∫${para(k1.toplam)}</span></div>
    </div>
    <div class="gunsonu-kasa-ozet">
      <h3><div class="kullanici-avatar av-k2" style="width:32px;height:32px;font-size:14px">G</div>Kasa 2 ‚Äî G√∂rkem</h3>
      <div class="gs-satir"><span class="gs-label">Ba≈ülangƒ±√ß Parasƒ±</span><span class="gs-val">‚Ç∫${para(BASLANGIC)}</span></div>
      <div class="gs-satir"><span class="gs-label" style="color:var(--giren)">+ Giren</span><span class="gs-val" style="color:var(--giren)">‚Ç∫${para(k2.giren)}</span></div>
      <div class="gs-satir"><span class="gs-label" style="color:var(--cikan)">‚àí √áƒ±kan</span><span class="gs-val" style="color:var(--cikan)">‚Ç∫${para(k2.cikan)}</span></div>
      <div class="gs-satir"><span class="gs-label">ƒ∞≈ülem Sayƒ±sƒ±</span><span class="gs-val">${k2.sayac} adet</span></div>
      <div class="gs-satir"><span class="gs-label">KAPANI≈û BAKƒ∞YESƒ∞</span><span class="gs-val" style="color:var(--gold)">‚Ç∫${para(k2.toplam)}</span></div>
    </div>
    <div class="gunsonu-kasa-ozet" style="grid-column:1/-1;border:2px solid var(--gold)">
      <h3>üìä ${tarihGoster} ‚Äî Genel √ñzet</h3>
      <div class="gs-satir"><span class="gs-label">Toplam Ba≈ülangƒ±√ß (2 Kasa)</span><span class="gs-val">‚Ç∫${para(BASLANGIC*2)}</span></div>
      <div class="gs-satir"><span class="gs-label" style="color:var(--giren)">+ Toplam Giren</span><span class="gs-val" style="color:var(--giren)">‚Ç∫${para(gG)}</span></div>
      <div class="gs-satir"><span class="gs-label" style="color:var(--cikan)">‚àí Toplam √áƒ±kan</span><span class="gs-val" style="color:var(--cikan)">‚Ç∫${para(gC)}</span></div>
      <div class="gs-satir"><span class="gs-label">G√úN SONU TOPLAM BAKƒ∞YE</span><span class="gs-val" style="color:var(--gold);font-size:22px">‚Ç∫${para(gT)}</span></div>
    </div>
    <div class="rapor-tablo" style="grid-column:1/-1">
      <table><thead><tr><th>SAAT</th><th>KASA</th><th>T√úR</th><th>A√áIKLAMA</th><th>TUTAR</th></tr></thead>
      <tbody>${window.islemler.filter(i=>i.tarih===tarih).map(i=>`
        <tr>
          <td>${i.saat}</td>
          <td><span class="badge badge-${i.kasa}">${i.kasa==='k1'?'KADƒ∞R':'G√ñRKEM'}</span></td>
          <td><span class="badge ${i.tur==='giren'?'badge-giren':'badge-cikan'}">${i.tur==='giren'?'Gƒ∞REN':'√áIKAN'}</span></td>
          <td>${esc(i.aciklama)}</td>
          <td style="color:${i.tur==='giren'?'var(--giren)':'var(--cikan)'}">${i.tur==='giren'?'+':'-'}‚Ç∫${para(i.tutar)}</td>
        </tr>`).join('')||'<tr><td colspan="5" style="text-align:center;color:var(--muted);padding:24px;font-size:12px">Bu tarihte i≈ülem yok</td></tr>'}
      </tbody></table>
    </div>
  `;
}

// Fƒ∞LTRELER
function filtreBugun(el) {
  const b=bugunStr(); document.getElementById('filtreBaslangic').value=b; document.getElementById('filtreBitis').value=b;
  document.querySelectorAll('.filtre-btn').forEach(x=>x.classList.remove('active')); el.classList.add('active'); renderGecmis();
}
function filtreHafta(el) {
  const now=new Date(), mon=new Date(now); mon.setDate(now.getDate()-now.getDay()+1);
  document.getElementById('filtreBaslangic').value=mon.toISOString().split('T')[0]; document.getElementById('filtreBitis').value=bugunStr();
  document.querySelectorAll('.filtre-btn').forEach(x=>x.classList.remove('active')); el.classList.add('active'); renderGecmis();
}
function filtreAy(el) {
  const now=new Date();
  document.getElementById('filtreBaslangic').value=`${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-01`; document.getElementById('filtreBitis').value=bugunStr();
  document.querySelectorAll('.filtre-btn').forEach(x=>x.classList.remove('active')); el.classList.add('active'); renderGecmis();
}

// TAB
function tabGec(id, btn) {
  document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('tab-'+id).classList.add('active'); btn.classList.add('active');
  if(id==='gecmis') renderGecmis();
  if(id==='rapor') raporGuncelle();
  if(id==='kullanici') renderKullanici();
}

// YARDIMCI
function para(n) { return Number(n).toLocaleString('tr-TR',{minimumFractionDigits:2,maximumFractionDigits:2}); }
function esc(t) { return String(t).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
function toast(msg, tip='ok') {
  const el=document.createElement('div'); el.className=`toast ${tip}`; el.textContent=msg;
  document.body.appendChild(el); setTimeout(()=>el.remove(),3000);
}
</script>
</body>
</html>
